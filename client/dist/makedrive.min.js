/*! makedrive 0.0.69 2015-05-27 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.MakeDrive=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(a){function c(b){return new a.URL(b)}function d(a){return a.href}b.exports={parse:c,format:d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b){(function(a){a.WebSocket&&(a.WebSocket.prototype.on=a.WebSocket.prototype.on||function(a,b){this.addEventListener(a,b)},a.WebSocket.prototype.removeListener=a.WebSocket.prototype.removeListener||function(a,b){this.removeEventListener(a,b)},a.WebSocket.prototype.once=a.WebSocket.prototype.once||function(a,b){var c=this;this.addEventListener(a,function d(){c.removeEventListener(a,d),b.apply(null,arguments)})},b.exports=a.WebSocket)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b){(function(c){function d(a){function b(b){if(a.windowCloseWarning&&m.state===m.SYNC_SYNCING){var d="Sync currently underway, are you sure you want to close?";return(b||c.event).returnValue=d,d}}function d(){j&&(i.debug("Closing manager"),j.close(),j=null)}a.manual=a.manual===!0,a.memory=a.memory===!0,a.autoReconnect=a.autoReconnect!==!1,a.memory&&(i.debug("Using Filer Memory provider for fs"),a.provider=new g.FileSystem.providers.Memory("makedrive")),a.provider?i.debug("Using user-provided provider for fs",a.provider):(i.debug("Using Fallback provider for fs"),a.provider=new g.FileSystem.providers.Fallback("makedrive"));var j,k=new g.FileSystem(a,function(a){a&&i.error("Filesystem initialization error",a)}),l=new f(k),m=l.sync=new h;Object.defineProperty(m,"downstreamQueue",{get:function(){return j&&j.downstreams}});var n;return m.SYNC_DISCONNECTED="SYNC DISCONNECTED",m.SYNC_CONNECTING="SYNC CONNECTING",m.SYNC_CONNECTED="SYNC CONNECTED",m.SYNC_SYNCING="SYNC SYNCING",m.state=m.SYNC_DISCONNECTED,m.auto=function(a){var b=a|!1?0|a:15e3;i.debug("Starting automatic syncing mode every "+b+"ms"),n&&clearInterval(n),n=setInterval(m.request,b)},m.manual=function(){i.debug("Starting manual syncing mode"),n&&(clearInterval(n),n=null)},m.onInterrupted=function(a){m.emit("error",new Error("Sync interrupted for path "+a)),i.warn("Sync interrupted by server for "+a)},m.onError=function(a){m.emit("error",a),i.error("Sync error",a)},m.onIdle=function(a){m.emit("idle",a),i.info("No sync took place: "+a)},m.onDisconnected=function(){"onbeforeunload"in c&&(i.debug("Removing window.beforeunload handler"),c.removeEventListener("beforeunload",b)),"onunload"in c&&(i.debug("Removing window.unload handler"),c.removeEventListener("unload",d)),m.state=m.SYNC_DISCONNECTED,m.emit("disconnected"),i.info("Disconnected from MakeDrive server")},m.request=function(){return m.state===m.SYNC_CONNECTING||m.state===m.SYNC_DISCONNECTED?(m.emit("error",new Error("MakeDrive error: MakeDrive cannot sync as it is either disconnected or trying to connect")),void i.warn("Tried to sync in invalid state: "+m.state)):(i.info("Requesting sync"),void j.syncUpstream())},m.connect=function(f,g){function h(g){j=new e(m,l,k),j.init(f,g,a,function(e){return e?(i.error("Error connecting to "+f,e),void m.onError(e)):(a.manual?m.manual():m.auto(a.interval),"onbeforeunload"in c&&c.addEventListener("beforeunload",b),"onunload"in c&&c.addEventListener("unload",d),m.state!==m.SYNC_SYNCING&&(m.state=m.SYNC_CONNECTED,m.emit("connected",f),i.info("MakeDrive connected to server at "+f)),m.onSyncing=function(a){m.state=m.SYNC_SYNCING,m.emit("syncing","Sync started for "+a),i.info("Sync started for "+a)},m.onCompleted=function(a,b){var c=j.downstreams;b=b||[],l.appendPathsToSync(b,function(b){return b?(m.emit("error",b),void i.error("Error appending paths to upstream after sync completed for "+a+" with error",b)):void l.getPathsToSync(function(b,d){var e;return b?(m.emit("error",b),void i.error("Error retrieving paths to sync after sync completed for "+a+" with error",b)):(e=d?d.concat(c):c,a&&(m.emit("completed",a),i.info("Sync completed for "+a)),void(e.length||m.allCompleted()))})})},void(m.allCompleted=function(){m.state!==m.SYNC_DISCONNECTED&&(m.state=m.SYNC_CONNECTED),m.emit("synced","MakeDrive has been synced"),i.info("All syncs completed")}))})}return m.state!==m.SYNC_DISCONNECTED?void i.warn("Tried to connect, but already connected"):void(j||(i.info("Connecting to MakeDrive server"),m.state=m.SYNC_CONNECTING,h(g)))},m.disconnect=function(){return m.state===m.SYNC_DISCONNECTED?void i.warn("Tried to disconnect while not connected"):(n&&(clearInterval(n),n=null),d(),void m.onDisconnected())},l}var e=a("./sync-manager.js"),f=a("./sync-filesystem.js"),g=a("../../lib/filer.js"),h=a("events").EventEmitter,i=a("./logger.js"),j={};j.log=i,j.Buffer=g.Buffer,j.Path=g.Path,j.Errors=g.Errors,b.exports=j;var k;j.fs=function(a){return a=a||{},a.forceCreate?d(a):(k||(k=d(a)),k)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../lib/filer.js":13,"./logger.js":4,"./sync-filesystem.js":6,"./sync-manager.js":7,events:27}],4:[function(a,b){function c(a,b){m>a||(b=Array.prototype.slice.call(b),b.unshift("[MakeDrive]",(l[a]||"").toUpperCase()+":"),console[a>=h?"error":"log"].apply(console,b))}var d=10,e=20,f=30,g=40,h=50,i=60,j=100,k={trace:d,debug:e,info:f,warn:g,error:h,fatal:i,disabled:j},l={TRACE:"trace",DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",FATAL:"fatal",DISABLED:"disabled"},m=j;b.exports={trace:function(){c(d,arguments)},debug:function(){c(e,arguments)},info:function(){c(f,arguments)},warn:function(){c(g,arguments)},error:function(){c(h,arguments)},fatal:function(){c(i,arguments)},TRACE:d,DEBUG:e,INFO:f,WARN:g,ERROR:h,FATAL:i,DISABLED:j,level:function(a){if(void 0===a)return m;if("string"==typeof a&&(a=k[a.toLowerCase()]),void 0===a||!(a>=d&&j>=a))throw new Error("invalid log level: "+a);m=a}}},{}],5:[function(a,b){function c(a,b){a.sync.onError(b)}function d(a,b,d,e){var f,g=a.fs,h=a.rawFs,k=a.sync;return 0!==b.indexOf(g.root)?(f=i.response.root,f.content={path:b,type:d},q.info("Ignoring "+d+" downstream sync for "+b),a.send(f.stringify())):(a.downstreams.push(b),k.onSyncing(b),void j.checksums(h,b,e,l,function(h,j){return h?(q.error("Failed to generate checksums for "+b+" during downstream sync",h),f=i.request.delay,f.content={path:b,type:d},a.send(f.stringify()),c(a,h)):(g.trackChanges(b,e),f=i.request.diffs,f.content={path:b,type:d,checksums:j},void a.send(f.stringify()))}))}function e(a,b){function e(){return b.invalidContent(["type","sourceList"])?(q.error("Path, type or source list not sent by server in handleChecksumRequest.",b),c(a,new Error("Server sent insufficient content"))):void d(a,b.content.path,b.content.type,b.content.sourceList)}function f(){if(b.invalidContent(["type","checksums"]))return q.warn(b,"Upstream sync message received from the server without sufficient information in handleDiffRequest"),void m.delaySync(function(b,d){return b?(q.error(b,"An error occured while updating paths to sync in handleDiffRequest"),c(a,b)):(q.info("Sync delayed for "+d+" in handleDiffRequest"),a.currentSync=!1,void a.syncUpstream())});var d,e=b.content.path,f=b.content.type,g=b.content.checksums;j.diff(o,e,g,l,function(b,g){b?(q.error(b,"Error generating diffs in handleDiffRequest for "+e),m.delaySync(function(d,f){return d?(q.error(b,"Error updating paths to sync in handleDiffRequest after failing to generate diffs for "+e),c(a,d)):(q.info("Sync delayed for "+f+" in handleDiffRequest"),a.currentSync=!1,void a.syncUpstream())})):(d=i.response.diffs,d.content={path:e,type:f,diffs:n(g)},a.send(d.stringify()))})}function g(){if(b.invalidContent(["type","oldPath"]))return q.error("Path, type or old path not sent by server in handleRenameRequest.",b),c(a,new Error("Server sent insufficient content"));var d,e=b.content.path,f=b.content.oldPath,g=b.content.type;return 0!==e.indexOf(m.root)?(d=i.response.root,d.content={path:e},q.info("Ignoring downstream sync for "+e),a.send(d.stringify())):(a.downstreams.push(e),p.onSyncing(f),void k.rename(o,f,e,function(b){return b?(q.error("Failed to rename "+f+" to "+e+" during downstream sync",b),d=i.request.delay,d.content={path:e,type:g},a.send(d.stringify()),c(a,b)):void k.generateChecksums(o,[e],!0,function(b,f){return b?(q.error("Failed to generate checksums for "+e+" during downstream rename",b),d=i.request.delay,d.content={path:e,type:g},a.send(d.stringify()),c(a,b)):(d=i.response.patch,d.content={path:e,type:g,checksum:f},void a.send(d.stringify()))})}))}function h(){if(b.invalidContent(["type"]))return q.error("Path or type not sent by server in handleRenameRequest.",b),c(a,new Error("Server sent insufficient content"));var d,e=b.content.path,f=b.content.type;return 0!==e.indexOf(m.root)?(d=i.response.root,d.content={path:e,type:f},q.info("Ignoring downstream sync for "+e),a.send(d.stringify())):(a.downstreams.push(e),p.onSyncing(e),void k.del(o,e,function(b){return b?(q.error("Failed to delete "+e+" during downstream sync",b),d=i.request.delay,d.content={path:e,type:f},a.send(d.stringify()),c(a,b)):void k.generateChecksums(o,[e],!1,function(b,g){return b?(q.error("Failed to generate checksums for "+e+" during downstream delete",b),d=i.request.delay,d.content={path:e,type:f},a.send(d.stringify()),c(a,b)):(d=i.response.patch,d.content={path:e,type:f,checksum:g},void a.send(d.stringify()))})}))}var m=a.fs,o=a.rawFs,p=a.sync;b.is.checksums?e():b.is.diffs?f():b.is.rename?g():b.is.del?h():c(a,new Error("Failed to sync with the server."))}function f(a,b){function e(){if(b.invalidContent(["type"]))return q.warn(b,"Upstream sync message received from the server without sufficient information in handleSourceListResponse"),n.delaySync(function(b,d){return b?(q.error(b,"An error occured while updating paths to sync in handleSourceListResponse"),c(a,b)):(q.info("Sync delayed for "+d+" in handleSourceListResponse"),a.currentSync=!1,void a.syncUpstream())});var d,e=b.content.path,f=b.content.type;return t.onSyncing(e),f===m.RENAME?(d=i.request.rename,d.content={path:e,oldPath:b.content.oldPath,type:f},a.send(d.stringify())):f===m.DELETE?(d=i.request.del,d.content={path:e,type:f},a.send(d.stringify())):void j.sourceList(s,e,l,function(b,g){return b?(q.error(b,"Error generating source list in handleSourceListResponse for "+e),n.delaySync(function(d,f){return d?(q.error(b,"Error updating paths to sync in handleSourceListResponse after failing to generate source list for "+e),c(a,d)):(q.info("Sync delayed for "+f+" in handleSourceListResponse"),a.currentSync=!1,void a.syncUpstream())})):(d=i.request.checksums,d.content={path:e,type:f,sourceList:g},void a.send(d.stringify()))})}function f(){function d(){p.removeUnsynced(n,e,function(b){b&&"ENOENT"!==b.code&&q.error("Failed to remove unsynced attribute for "+e+" in handlePatchAckResponse, complete()"),a.syncNext(e)})}var e=b.content.path;n.lstat(e,function(b,f){return b?"ENOENT"!==b.code?(q.error("Failed to access "+e+" in handlePatchAckResponse"),n.delaySync(function(d,e){d&&q.error("Failed to delay upstream sync for "+e+" in handlePatchAckResponse"),c(a,b)})):d():f.isFile()?void k.getChecksum(s,e,function(b,f){return b?(q.error("Failed to get the checksum for "+e+" in handlePatchAckResponse"),n.delaySync(function(d,e){d&&q.error("Failed to delay upstream sync for "+e+" in handlePatchAckResponse while getting checksum"),c(a,b)})):void p.setChecksum(s,e,f,function(b){return b?(q.error("Failed to stamp the checksum for "+e+" in handlePatchAckResponse"),n.delaySync(function(d,e){d&&q.error("Failed to delay upstream sync for "+e+" in handlePatchAckResponse while setting checksum"),c(a,b)})):void d()})}):d()})}function g(){var e;if(b.invalidContent(["type","diffs"]))return q.error("Path, type or diffs not sent by server in handleDiffResponse.",b),c(a,new Error("Server sent insufficient content"));var f=b.content.path,g=b.content.type,h=o(b.content.diffs),m=n.changesDuringDownstream.indexOf(f),t=n.untrackChanges(f);return-1!==m?d(a,f,g,t):void j.patch(s,f,h,l,function(b,d){if(b)return q.error("Failed to patch "+f+" during downstream sync",b),e=i.request.delay,e.content={path:f,type:g},a.send(e.stringify()),c(a,b);var h=d.needsUpstream;a.needsUpstream=a.needsUpstream||[],a.needsUpstream.forEach(function(b){-1===h.indexOf(b)&&a.needsUpstream.push(b)}),p.getPathsToSync(s,n.root,function(b,j){if(b)return q.error("Failed to update paths to sync during downstream sync",b),e=i.request.delay,e.content={path:f,type:g},a.send(e.stringify()),c(a,b);var l;j&&j.toSync&&-1===h.indexOf(f)&&(l=r(j.toSync,f),-1!==l&&j.toSync.splice(l,1)),p.setPathsToSync(s,n.root,j,function(b){return b?(q.error("Failed to update paths to sync during downstream sync",b),e=i.request.delay,e.content={path:f,type:g},a.send(e.stringify()),c(a,b)):void k.generateChecksums(s,d.synced,!0,function(b,h){return b?(q.error("Failed to generate checksums for "+d.synced+" during downstream patch",b),e=i.request.delay,e.content={path:f,type:g},a.send(e.stringify()),c(a,b)):(e=i.response.patch,e.content={path:f,type:g,checksum:h},void a.send(e.stringify()))})})})})}function h(){var c=b.content&&b.content.path;a.downstreams.splice(a.downstreams.indexOf(c),1),t.onCompleted(c,a.needsUpstream)}var n=a.fs,s=a.rawFs,t=a.sync;b.is.sync?e():b.is.patch?f():b.is.diffs?g():b.is.verification?h():c(a,new Error("Failed to sync with the server."))}function g(a,b){function c(){g.dequeueSync(function(b,c,d){return b?void q.fatal("Fatal error trying to dequeue sync in handleForcedDownstream"):(a.currentSync=!1,void f.onInterrupted(d))})}function d(){g.delaySync(function(b,c){return b?void q.fatal("Fatal error trying to delay sync in handleUpstreamError"):(a.currentSync=!1,void f.onInterrupted(c))})}function e(){a.downstreams&&a.downstreams.length&&a.downstreams.splice(a.downstreams.indexOf(h),1),g.untrackChanges(h),f.onInterrupted(h)}var f=a.sync,g=a.fs,h=b.content&&b.content.path;b.is.content?q.error("Invalid content was sent to the server"):b.is.needsDownstream?(q.warn("Cancelling upstream for "+h+", downstreaming instead"),c()):b.is.impl?(q.error("Server could not initialize upstream sync for "+h),d()):b.is.interrupted?(q.error("Server interrupted upstream sync due to incoming downstream for "+h),d()):b.is.locked?(q.error("Server cannot process upstream request due to "+h+" being locked"),d()):b.is.fileSizeError?(q.error("Maximum file size for upstream syncs exceeded for "+h),d()):b.is.checksums?(q.error("Error generating checksums on the server for "+h),d()):b.is.patch?(q.error("Error patching "+h+" on the server"),d()):b.is.sourceList?q.fatal("Fatal error, server could not generate source list"):b.is.diffs?(q.error("Error generating diffs on the server for "+h),e()):b.is.downstreamLocked?(q.error("Cannot downstream due to lock on "+h+" on the server"),e()):b.is.verification?(q.fatal("Patch could not be verified due to incorrect patching on downstreaming "+h+". Possible file corruption."),e()):q.fatal(b,"Unknown error sent by the server")}function h(a,b){try{b=JSON.parse(b),b=i.parse(b)}catch(d){return c(a,d)}b.is.request?e(a,b):b.is.response?f(a,b):b.is.error?g(a,b):c(a,new Error("Cannot handle message"))}var i=a("../../lib/syncmessage"),j=a("../../lib/rsync"),k=j.utils,l=a("../../lib/constants").rsyncDefaults,m=a("../../lib/constants").syncTypes,n=a("../../lib/diff").serialize,o=a("../../lib/diff").deserialize,p=a("../../lib/fs-utils"),q=a("./logger.js"),r=a("../../lib/util.js").findPathIndexInArray;b.exports=h},{"../../lib/constants":10,"../../lib/diff":11,"../../lib/fs-utils":14,"../../lib/rsync":17,"../../lib/syncmessage":21,"../../lib/util.js":22,"./logger.js":4}],6:[function(a,b){function c(a){function b(b,c){f.fsetUnsynced(a,b,c)}function c(b,c){f.setUnsynced(a,b,c)}function k(b,c,d,e){return function(){function k(){var a=Array.prototype.slice.call(arguments,0);return a[0]||e===h.DELETE?q.apply(null,a):void d(r,function(b){return b?q(b):void q.apply(null,a)})}var o=Array.prototype.slice.call(arguments,0),p=o.length-1,q=o[p],r=o[c];o[p]=k,e===h.DELETE&&r===m&&j.warn("Tried to delete the sync root "+m),g.isConflictedCopy(a,r,function(d,g){return d&&"ENOENT"!==d.code?q.apply(null,[d]):(g=!!g,a.openFiles[r]||0!==r.indexOf(m)||g?void a[b].apply(a,o):(-1!==n.indexOf(r)&&-1===l.changesDuringDownstream.indexOf(r)&&l.changesDuringDownstream.push(r),void f.getPathsToSync(a,m,function(d,g){if(d)return q(d);var j={path:r,type:e};e===h.RENAME&&(j.oldPath=o[c-1]);var k;g=g||{},g.toSync=g.toSync||[],k=i(g.toSync,r),0===k&&g.toSync[0].syncing?g.modified=r:-1===k&&g.toSync.push(j),f.setPathsToSync(a,m,g,function(c){return c?q(c):void a[b].apply(a,o)})})))})}}var l=this,m="/",n=[],o=[],p=[];Object.defineProperties(l,{root:{get:function(){return m}},changesDuringDownstream:{get:function(){return p}}}),l.trackChanges=function(a,b){n.push(a),o.push(b)},l.untrackChanges=function(a){var b=n.indexOf(a),c=p.indexOf(a);return-1===b?(j.error("Path "+a+" not found in tracked paths list"),null):(n.splice(b,1),-1!==c&&p.splice(p.indexOf(a),1),o.splice(b,1)[0])},l.getPathsToSync=function(b){f.getPathsToSync(a,m,function(a,c){return a?b(a):void b(null,c&&c.toSync)})},l.appendPathsToSync=function(b,c){if(!b||!b.length)return c();var d=[];b.forEach(function(a){var b=a.path?a:{path:a,type:h.CREATE};0===b.path.indexOf(m)&&d.push(b)}),f.getPathsToSync(a,m,function(b,e){if(b)return c(b);e=e||{},e.toSync=e.toSync||[];var g=e.toSync;d.forEach(function(a){var b=!g.every(function(b){return b.path!==a.path});b||e.toSync.push(a)}),f.setPathsToSync(a,m,e,c)})},l.getModifiedPath=function(b){f.getPathsToSync(a,m,function(a,c){return a?b(a):void b(null,c&&c.modified)})},l.setSyncing=function(b){f.getPathsToSync(a,m,function(a,c){return a?b(a):c&&c.toSync&&c.toSync[0]?(c.toSync[0].syncing=!0,void b()):(j.warn("setSyncing() called when no paths to sync present"),b())})},l.delaySync=function(b){f.getPathsToSync(a,m,function(c,d){if(c)return b(c);if(!d||!d.toSync||!d.toSync[0])return j.warn("delaySync() called when no paths to sync present"),b();var e=d.toSync.shift();d.toSync.push(e),delete d.modified,f.setPathsToSync(a,m,d,function(a){return a?b(a):void b(null,e.path)})})},l.dequeueSync=function(b){f.getPathsToSync(a,m,function(c,d){if(c)return b(c);if(!d||!d.toSync||!d.toSync[0])return j.warn("dequeueSync() called when no paths to sync present"),b();var e=d.toSync.shift();d.toSync.length||delete d.toSync,delete d.modified,f.setPathsToSync(a,m,d,function(a){return a?b(a):void b(null,d.toSync,e.path)})})},l.setRoot=function(b,c){function e(a){return"object"==typeof a&&(a=a.path||""),0===a.indexOf(b)}a.lstat(b,function(g,h){return g?c(g):h.isDirectory()?void f.getPathsToSync(a,m,function(a,d){return a?c(a):(m=b,d?(d.toSync&&(d.toSync=d.toSync.filter(e),d.toSync.length||delete d.toSync),d.modified&&!e(d.modified)&&delete d.modified,void c()):c())}):c(new d.Errors.ENOTDIR("the given root is not a directory",b))})},["stat","fstat","lstat","exists","readlink","realpath","readdir","open","close","fsync","read","readFile","setxattr","fsetxattr","getxattr","fgetxattr","removexattr","fremovexattr","watch"].forEach(function(b){l[b]=function(){a[b].apply(a,arguments)}}),["truncate","mknod","mkdir","utimes","writeFile","appendFile"].forEach(function(a){l[a]=k(a,0,c,h.CREATE)}),["link","symlink"].forEach(function(a){l[a]=k(a,1,c,h.CREATE)}),["rename"].forEach(function(a){l[a]=k(a,1,c,h.RENAME)}),["ftruncate","futimes","write"].forEach(function(a){l[a]=k(a,0,b,h.CREATE)}),["rmdir","unlink"].forEach(function(a){l[a]=k(a,0,c,h.DELETE)});var q=l.rename;l.rename=function(b,c,d){q(b,c,function(b){return b?d(b):void g.isConflictedCopy(a,c,function(b,e){return b?d(b):e?void g.removeFileConflict(a,c,function(b){return b?d(b):void f.getPathsToSync(a,m,function(b,e){var g,j;return b?d(b):(g=i(e.toSync,c),void(-1!==g&&(j=e.toSync[g],j.type=h.CREATE,delete j.oldPath,e.toSync[g]=j,f.setPathsToSync(a,m,e,d))))})}):d()})})},l.Shell=e.bind(void 0,l),l.getUnsynced=function(b,c){f.getUnsynced(a,b,c)},l.fgetUnsynced=function(b,c){f.fgetUnsynced(a,b,c)}}var d=a("../../lib/filer.js"),e=a("../../lib/filer-shell.js"),f=a("../../lib/fs-utils.js"),g=a("../../lib/conflict.js"),h=a("../../lib/constants.js").syncTypes,i=a("../../lib/util.js").findPathIndexInArray,j=a("./logger.js");b.exports=c},{"../../lib/conflict.js":9,"../../lib/constants.js":10,"../../lib/filer-shell.js":12,"../../lib/filer.js":13,"../../lib/fs-utils.js":14,"../../lib/util.js":22,"./logger.js":4}],7:[function(a,b){function c(a,b,c){var d=this;d.sync=a,d.fs=b,d.rawFs=c,d.downstreams=[],d.needsUpstream=[]}var d=a("../../lib/syncmessage"),e=a("./message-handler"),f=a("ws"),g=a("request"),h=a("url"),i=a("./logger.js");c.prototype.init=function(a,b,c,i){function j(a){var b=a.data||a;try{b=JSON.parse(b),b=d.parse(b)}catch(c){return i(c)}b.is.response&&b.is.authz?(n.onmessage=function(a){var b=a.data||a;e(s,b)},s.send(d.response.authz.stringify()),i()):i(new Error("Cannot handle message"))}function k(a){var b=a.reason||"WebSocket closed unexpectedly",c=new Error(a.code+": "+b);s.close(),s.socket=null,t.onError(c),t.onDisconnected()}function l(b){var c;try{c=h.parse(a)}catch(d){t.onError(d)}c.protocol="wss:"===c.protocol?"https:":"http:",c.pathname="api/sync",c=h.format(c),g({url:c,method:"GET",json:!0,withCredentials:!0},function(a,c,d){var e,f;e=c&&c.statusCode,f=200!==e?{message:a||"Unable to get token",code:e}:null,f?t.onError(f):b(d)})}function m(d){clearTimeout(o),n=new f(a),n.onmessage=j,n.onopen=function(){s.socket=n,u=0,!d&&b?s.send(JSON.stringify({token:b})):l(function(a){s.send(JSON.stringify({token:a}))})},n.onclose=c.autoReconnect?function(){if(n.onclose=function(){},n.close(),n=null,s.socket=null,0===u){var a=new Error("WebSocket closed unexpectedly");t.onError(a),t.onDisconnected()}if(u>p)t.emit("reconnect_failed");else{var b=u*q;b=Math.min(b,r),o=setTimeout(function(){u++,t.emit("reconnecting"),m(!0)},b)}}:k}var n,o,p,q,r,s=this,t=s.sync,u=0;c.autoReconnect&&(p=c.reconnectAttempts?c.reconnectAttempts:Math.Infinity,q=c.reconnectionDelay?c.reconnectionDelay:1e3,r=c.reconnectionDelayMax?c.reconnectionDelayMax:5e3),m()},c.prototype.syncUpstream=function(){var a,b,c=this,e=c.fs,f=c.sync;if(!c.socket)throw new Error("sync called before init");return c.currentSync?void f.onError(new Error("Sync currently underway")):void e.getPathsToSync(function(g,h){return g?void f.onError(g):h&&h.length?(b=h[0],void e.setSyncing(function(e){return e?void f.onError(e):(c.currentSync=b,a=d.request.sync,a.content={path:b.path,type:b.type},b.oldPath&&(a.content.oldPath=b.oldPath),void c.send(a.stringify()))})):(i.warn("Nothing to sync"),void f.onIdle("No changes made to the filesystem"))})},c.prototype.syncNext=function(a){var b=this,c=b.fs,d=b.sync;c.dequeueSync(function(c,e,f){c&&i.error("Failed to dequeue sync for "+a+" in SyncManager.syncNext()"),d.onCompleted(f||a),b.currentSync=!1,b.syncUpstream()})},c.prototype.close=function(){var a=this,b=a.socket;b&&(b.onmessage=function(){},b.onopen=function(){},1===b.readyState?(b.onclose=function(){a.socket=null},b.close()):a.socket=null)},c.prototype.send=function(a){var b=this,c=b.sync,d=b.socket;d&&d.readyState===d.OPEN||c.onError(new Error("Socket state invalid for sending"));try{d.send(a)}catch(e){d.close()}},b.exports=c},{"../../lib/syncmessage":21,"./logger.js":4,"./message-handler":5,request:26,url:1,ws:2}],8:[function(a,b){b.exports=a("../node_modules/filer/lib/async.js")},{"../node_modules/filer/lib/async.js":28}],9:[function(a,b){function c(a,b,c){var d=j.dirname(b),e=j.basename(b),f=j.extname(b),g=new Date,h=g.getFullYear()+"-"+g.getMonth()+"-"+g.getDay()+" "+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds(),i=" (Conflicted Copy "+h+")",k=j.join(d,e+i+f);l.forceCopy(a,b,k,function(a){return a?c(a):void c(null,k)})}function d(a){return/\(Conflicted Copy \d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2}\)/.test(a)}function e(a){return a-parseFloat(a)+1>=0}function f(a,b,c){var d;d=e(b)?"fgetxattr":"getxattr",a[d](b,k.attributes.conflict,function(a,b){return a&&"ENOATTR"!==a.code?c(a):void c(null,!!b)})}function g(a,b,d){a.lstat(b,function(e,f){return e?d(e):f.isDirectory()?d(new i.Errors.EISDIR("conflict not permitted on directory")):void c(a,b,function(b,c){return b?d(b):void a.setxattr(c,k.attributes.conflict,!0,function(a){return a?d(a):void d(null,c)})})})}function h(a,b,c){a.removexattr(b,k.attributes.conflict,function(a){return a&&"ENOATTR"!==a.code?c(a):void c()})}var i=a("./filer.js"),j=i.Path,k=a("./constants.js"),l=a("./fs-utils.js");b.exports={filenameContainsConflicted:d,isConflictedCopy:f,makeConflictedCopy:g,removeFileConflict:h}},{"./constants.js":10,"./filer.js":13,"./fs-utils.js":14}],10:[function(a,b){b.exports={rsyncDefaults:{size:5,time:!0,recursive:!1,superficial:!0},attributes:{unsynced:"makedrive-unsynced",conflict:"makedrive-conflict",checksum:"makedrive-checksum",partial:"makedrive-partial",pathsToSync:"makedrive-pathsToSync"},syncTypes:{CREATE:"create",RENAME:"rename",DELETE:"delete"},server:{syncChannel:"makedrive-sync",lockRequestChannel:"makedrive-lock-request",lockResponseChannel:"makedrive-lock-response",states:{CREATED:"CREATED",CLOSED:"CLOSED",CLOSING:"CLOSING",CONNECTING:"CONNECTING",LISTENING:"LISTENING",INIT:"INIT",OUT_OF_DATE:"OUT_OF_DATE",SYNCING:"SYNCING",CHKSUM:"CHKSUM",PATCH:"PATCH",ERROR:"ERROR"}}}},{}],11:[function(a,b){function c(a,b){return a.diffs&&(a.diffs=a.diffs.map(function(a){return a.data=b(a.data),a})),a}function d(a){if(!g.isBuffer(a))return a;var b=a.toJSON();return b.data||b}function e(a){return new g(a)}function f(a,b){return a.length?a.map(function(a){return c(a,b)}):a}var g=a("./filer.js").Buffer;b.exports.serialize=function(a){return f(a,d)},b.exports.deserialize=function(a){return f(a,e)}},{"./filer.js":13}],12:[function(a,b){b.exports=a("../node_modules/filer/src/shell/shell.js")},{"../node_modules/filer/src/shell/shell.js":54}],13:[function(a,b){b.exports=a("filer")},{filer:44}],14:[function(a,b){function c(a,b,c,d){a.getxattr(b,c,function(a,b){return a&&"ENOENT"===a.code?d(null,!1):a&&"ENOATTR"!==a.code?d(a):void d(null,!!b)})}function d(a,b,c,d,e){var f="fremovexattr";d!==!0&&(e=d,f="removexattr"),a[f](b,c,function(a){return a&&"ENOATTR"!==a.code?e(a):void e()})}function e(a,b,c,d,e){var f="fgetxattr";d!==!0&&(e=d,f="getxattr"),a[f](b,c,function(a,b){return a&&"ENOATTR"!==a.code?e(a):void e(null,b)})}function f(a,b,c,d){a.unlink(c,function(e){return e&&"ENOENT"!==e.code?d(e):void a.readFile(b,function(b,e){return b?d(b):void a.writeFile(c,e,d)})})}function g(a,b,d){c(a,b,E.attributes.unsynced,d)}function h(a,b,c){d(a,b,E.attributes.unsynced,c)}function i(a,b,c){d(a,b,E.attributes.unsynced,!0,c)}function j(a,b,c){a.setxattr(b,E.attributes.unsynced,Date.now(),c)}function k(a,b,c){a.fsetxattr(b,E.attributes.unsynced,Date.now(),c)}function l(a,b,c){e(a,b,E.attributes.unsynced,c)}function m(a,b,c){e(a,b,E.attributes.unsynced,!0,c)}function n(a,b,c){d(a,b,E.attributes.checksum,c)}function o(a,b,c){d(a,b,E.attributes.checksum,!0,c)}function p(a,b,c,d){a.setxattr(b,E.attributes.checksum,c,d)}function q(a,b,c,d){a.fsetxattr(b,E.attributes.checksum,c,d)}function r(a,b,c){e(a,b,E.attributes.checksum,c)}function s(a,b,c){e(a,b,E.attributes.checksum,!0,c)}function t(a,b,d){c(a,b,E.attributes.partial,d)}function u(a,b,c){d(a,b,E.attributes.partial,c)}function v(a,b,c){d(a,b,E.attributes.partial,!0,c)}function w(a,b,c,d){a.setxattr(b,E.attributes.partial,c,d)}function x(a,b,c,d){a.fsetxattr(b,E.attributes.partial,c,d)}function y(a,b,c){e(a,b,E.attributes.partial,c)}function z(a,b,c){e(a,b,E.attributes.partial,!0,c)}function A(a,b,c,d){a.setxattr(b,E.attributes.pathsToSync,c,d)}function B(a,b,c,d){a.fsetxattr(b,E.attributes.pathsToSync,c,d)}function C(a,b,c){e(a,b,E.attributes.pathsToSync,c)}function D(a,b,c){e(a,b,E.attributes.pathsToSync,!0,c)}var E=a("./constants.js");b.exports={forceCopy:f,isPathUnsynced:g,removeUnsynced:h,fremoveUnsynced:i,setUnsynced:j,fsetUnsynced:k,getUnsynced:l,fgetUnsynced:m,removeChecksum:n,fremoveChecksum:o,setChecksum:p,fsetChecksum:q,getChecksum:r,fgetChecksum:s,isPathPartial:t,removePartial:u,fremovePartial:v,setPartial:w,fsetPartial:x,getPartial:y,fgetPartial:z,setPathsToSync:A,fsetPathsToSync:B,getPathsToSync:C,fgetPathsToSync:D}},{"./constants.js":10}],15:[function(a,b){var c=a("./rsync-utils"),d=a("../async-lite");b.exports=function(a,b,e,f,g){function h(a,b){this.path=a,this.type=b}function i(b,d,e){function g(){c.blockChecksums(a,d.path,f.size,function(a,c){return a?e(a):(b.checksums=c,b.modified=d.modified,n.push(b),void e())})}return f.checksum&&!f.recursive?g():void a.stat(d.path,function(a,c){return a&&"ENOENT"!==a.code?e(a):c&&c.mtime===d.modified&&c.size===d.size?(b.checksums=[],b.modified=d.modified,b.identical=!0,n.push(b),e()):void g()})}function j(b,d,e){function g(){a.readlink(d.path,function(d,g){return d?e(d):void c.blockChecksums(a,g,f.size,function(a,c){return a?e(a):(b.checksums=c,n.push(b),void e())})})}return f.checksum&&!f.recursive?(n.push(b),e()):void a.stat(d.path,function(a,c){return a&&"ENOENT"!==a.code?e(a):c&&c.mtime===d.modified&&c.size===d.size?(b.identical=!0,n.push(b),e()):a&&"ENOENT"===a.code?(n.push(b),e()):void g()})}function k(a,b){a.checksums=[],n.push(a),b()}function l(a,b){var c=a.type,d=new h(a.path,c);return"DIRECTORY"===c?k(d,b):"SYMLINK"===c&&f.links?(d.link=!0,j(d,a,b)):void i(d,a,b)}g=c.findCallback(g,f);var m=c.validateParams(a,b);if(m)return g(m);f=c.configureOptions(f);var n=[];d.eachSeries(e,l,function(a){a?g(a):g(null,n)})}},{"../async-lite":8,"./rsync-utils":19}],16:[function(a,b){var c=a("../filer").Errors,d=a("./rsync-utils"),e=a("../async-lite");b.exports=function(a,b,f,g,h){function i(a,b,c){this.path=a,this.type=b,this.modified=c}function j(b,c,e){d.getChecksum(a,c,function(a,c){return a?e(a):(b.checksum=c,o.push(b),void e(null,o))})}function k(b,c){var e=b.path,f=new i(e,b.type,b.modified);a.readlink(e,function(e,h){return e?c(e):(f.link=h,g.links?(o.push(f),c(null,o)):void a.readFile(h,function(a,e){return a?c(a):(f.diffs=d.rollData(e,b.checksums,g.size),g.versions?j(f,h,c):(o.push(f),void c(null,o)))}))})}function l(b,c){var e=b.path,f=new i(e,b.type,b.modified);return b.identical?(f.diffs=[],o.push(f),c(null,o)):void a.readFile(e,function(a,h){return a?c(a):(f.diffs=d.rollData(h,b.checksums,g.size),g.versions?j(f,e,c):(o.push(f),void c(null,o)))})}function m(){function b(b,c){var d=b.path,e=new i(d,b.type);return"DIRECTORY"===b.type?(e.diffs=[],g.recursive?(o.push(e),c()):a.readdir(d,function(a,b){return a?c(a):(e.nodeList=b||[],o.push(e),c())})):b.link?k(b,c):void l(b,c)}e.eachSeries(f,b,function(a){return a?h(a):void h(null,o)})}h=d.findCallback(h,g);var n=d.validateParams(a,b);if(n)return h(n);if(g=d.configureOptions(g),g.checksum&&!f)return h(new c.EINVAL("Checksums must be provided"));var o=[];return f.length?void a.lstat(b,function(a,b){if(a)return h(a);if(b.isDirectory())return m();var c=f[0];return b.isFile()||!g.links?l(c,h):void k(c,h)}):h(null,o)}},{"../async-lite":8,"../filer":13,"./rsync-utils":19}],17:[function(a,b){b.exports={sourceList:a("./source-list"),checksums:a("./checksums"),diff:a("./diff"),patch:a("./patch"),utils:a("./rsync-utils")}},{"./checksums":15,"./diff":16,"./patch":18,"./rsync-utils":19,"./source-list":20}],18:[function(a,b){function c(a){function b(a){return a.path
}return a.map(b)}function d(a,b){return a.filter(function(a){return-1===b.indexOf(a)})}var e=a("../fs-utils"),f=a("../filer"),g=f.Buffer,h=f.Path,i=a("../async-lite"),j=a("../conflict"),k=a("./rsync-utils");b.exports=function(a,b,f,l,m){function n(a,b){var c=d(z,y.synced);y.failed=y.failed.concat(c),b(a,y)}function o(b,c){function d(b,c,d){return-1!==z.indexOf(b)?d():void e.isPathUnsynced(a,b,function(e,f){return e?n(e,d):f?d():void j.isConflictedCopy(a,b,function(e,f){return e?n(e,d):f?d():(y.synced.push(b),void(c.isDirectory()?a.rmdir(b,d):a.unlink(b,d)))})})}function f(c,e){var f=h.join(b,c);a.lstat(f,function(a,b){return a?n(a,e):b.isDirectory()?void o(f,e):d(f,b,e)})}function g(a,e){i.eachSeries(a,f,function(a){return a?n(a,c):void d(b,e,function(a){return a?n(a,c):void c(null,y)})})}a.lstat(b,function(d,e){return d&&"ENOENT"!==d.code?c(d):d&&"ENOENT"===d.code||!e.isDirectory()?c(null,y):void a.readdir(b,function(a,b){return a?n(a,c):void g(b,e)})})}function p(b,c,d){e.getPartial(a,c,function(f,g){return f?d(f):g?(g.splice(g.indexOf(b),1),g.length?void e.setPartial(a,c,g,function(a){return a?d(a):void d(null,y)}):e.removePartial(a,c,function(a){return a?d(a):void d(null,y)})):d(null,y)})}function q(b,c){e.isPathUnsynced(a,b,function(d,f){return d?n(d,c):f?void j.makeConflictedCopy(a,b,function(d){return d?n(d,c):void e.removeUnsynced(a,b,function(a){return a?n(a,c):void c()})}):c()})}function r(b,c){function d(d){a.lstat(m,function(f,g){return f?n(f,c):g.mtime<=b.modified?i(j(d)):void e.getChecksum(a,m,function(a,e){return a?n(a,c):e===b.checksum?(y.needsUpstream.push(m),p(m,h.dirname(m),c)):void i(j(d))})})}function f(){a.utimes(m,b.modified,b.modified,function(a){return a?n(a,c):(y.synced.push(m),void p(m,h.dirname(m),c))})}function i(b){q(m,function(d){return d?n(d,c):void a.writeFile(m,b,function(a){return a?n(a,c):l.time?f():(y.synced.push(m),void p(m,h.dirname(m),c))})})}function j(a){function c(b){var c=b*l.size,d=c+l.size;return d=d>a.length?a.length:d,a.slice(c,d)}for(var d,e,f=[],h=0;k>h;h++)d=b.diffs[h],e=d.data||c(d.index),f.push(e),d.data&&d.index&&f.push(c(d.index));return g.concat(f)}var k=b.diffs?b.diffs.length:0,m=b.path;return k?void a.readFile(m,function(a,b){return a?"ENOENT"!==a.code?n(a,c):i(j(new g(0))):l.versions?void d(b):i(j(b))}):(y.synced.push(m),c(null,y))}function s(b,c){var d=b.path;return l.links?void a.symlink(b.link,d,function(a){return a?n(a,c):(y.synced.push(d),void p(d,h.dirname(d),c))}):r(b,c)}function t(b,c){var d=b.path;a.mkdir(d,function(f){return f?"EEXIST"!==f.code?n(f,c):(y.synced.push(d),c(null,y)):l.recursive?(y.synced.push(d),c(null,y)):void e.setPartial(a,d,b.nodeList,function(a){return a?n(a,c):(y.synced.push(d),y.partial.push(d),void p(d,h.dirname(d),c))})})}function u(a,b){return"DIRECTORY"===a.type?t(a,b):"SYMLINK"===a.type?s(a,b):void r(a,b)}function v(a,b){x(a.path,function(c){return c?b(c):void u(a,b)})}function w(){i.eachSeries(f,v,function(c){return c?n(c,m):void e.getPartial(a,b,function(c,d){return c?m(c):d&&0===d.length?void e.removePartial(a,b,function(a){return a?n(a,m):(y.partial.splice(y.partial.indexOf(b),1),void(l.superficial?m(null,y):o(b,m)))}):l.superficial?m(null,y):o(b,m)})})}function x(b,c){(new a.Shell).mkdirp(h.dirname(b),function(a){return a&&"EEXIST"!==a.code?c(a):void c()})}m=k.findCallback(m,l);var y={synced:[],failed:[],needsUpstream:[],partial:[]},z=c(f),A=k.validateParams(a,b);return A?m(A):(l=k.configureOptions(l),f&&f.length?w():void x(b,function(a){return a&&"EEXIST"!==a?m(a,y):void o(b,m)}))}},{"../async-lite":8,"../conflict":9,"../filer":13,"../fs-utils":14,"./rsync-utils":19}],19:[function(a,b){function c(a){return a&&"function"!=typeof a||(a={}),a.size=a.size||512,a.checksum=a.checksum!==!1,a.recursive=a.recursive||!1,a.time=a.time||!1,a.links=a.links||!1,a.versions=a.versions!==!1,a.superficial=a.superficial||!1,a}function d(a,b){return a||"function"!=typeof b||(a=b),a}function e(a,b){var c;return a?b||(c=new s.EINVAL("Second argument must be specified")):c=new s.EINVAL("No filesystem provided"),c}function f(a){return q(a).toString()}function g(a,b,c,d){var e=0,f=0,g=65536,h=65521;if(b){var i=c,j=d-1,k=i-1,l=j-1,m=a[k],n=a[j];e=(b.a-m+n)%h,f=(b.b-(l-k+1)*m+e)%h}else{for(var o,p=c>=0&&d>=0?d-c+1:a.length,q=0;p>q;q++)o=a[q],e+=o,f+=(p-q)*o;e%=h,f%=h}return{a:e,b:f,sum:e+f*g}}function h(a){return 65535&(a>>16^1009*a)}function i(a){for(var b,c,d={},e=a.length,f=0;e>f;f++)b=a[f],c=h(b.weak),d[c]?d[c].push(b):d[c]=[b];return d}function j(a,b,c){for(var d,e,j,k,l,m,n,o,p,q,r=[],s=i(b),t=a.length,u=0,v=c>t?t:c,w=0,x=null;t>=v;u++,v++){if(d=g(a,x,u,v),e=h(d.sum),j=!1,k=null,x=d,p=s[e]){l=p.length;for(var y=0;l>y;y++)if(q=p[y],q.weak===d.sum&&(m=q,n=a.slice(u,v),o=f(n),m.strong===o)){j=m;break}}j?(w>u?(k=a.slice(w-1,v),r.push({data:k,index:j.index})):u-w>0?(k=a.slice(w,u),r.push({data:k,index:j.index})):r.push({index:j.index}),w=v):v===t&&(k=a.slice(w),r.push({data:k}))}return r}function k(a,b,c,d){var e={};a.readFile(b,function(a,h){if(a){if(!a||"ENOENT"!==a.code)return d(a);e[b]=[]}else e[b]=h;for(var i,j,k,l=e[b].length,m=c,n=0,o=m>l?l:m,p=0,q=[];l>n;)i=e[b].slice(n,o),j=g(i).sum,k=f(i),q.push({index:p,weak:j,strong:k}),n+=m,o=o+m>l?l:o+m,p++;d(null,q)})}function l(a,b,c){a.readFile(b,function(a,b){a?"ENOENT"===a.code?c(null,""):c(a):c(null,f(b))})}function m(a,b,c,f){function g(a,b,c){this.path=a,this.type=b,this.checksum=c}function h(a,b,c,d){var e;"function"==typeof c?(d=c,e=new g(a,b)):e=new g(a,b,c),m.push(e),d()}function i(b,d,e){v.isPathUnsynced(a,b,function(f,g){return f?e(f):g?e():void l(a,b,function(f,g){return f?e(f):c&&""!==g?void v.setChecksum(a,b,g,function(a){return a?e(a):void h(b,d,g,e)}):h(b,d,g,e)})})}function j(b,c){a.lstat(b,function(a,d){var e=d&&d.type;if(a){if("ENOENT"!==a.code)return c(a);i(b,e,c)}else d.isDirectory()?h(b,e,c):i(b,e,c)})}"function"!=typeof f&&(f=d(f,c),c=!1);var k=e(a,b);if(k)return f(k);var m=[];u.eachSeries(b,j,function(a){return a?f(a):void f(null,m)})}function n(a,b,c){function d(b,c){var d=b.path;a.lstat(d,function(e,g){if(e&&"ENOENT"!==e.code)return c(e);if(!e&&b.type!==g.type)return c(f);if(!e&&g.isDirectory()){if(!b.checksum)return c();c(f)}l(a,d,function(a,d){return a?c(a):d!==b.checksum?c(f):void c()})})}var f="Checksums do not match",g=e(a,b);return g?c(g):void u.eachSeries(b,d,function(a){return a&&a!==f?c(a):void c(null,a!==f)})}function o(a,b,c){var d=e(a,b);return d?c(d):void a.lstat(b,function(d,e){return d?c(d):void(e.isDirectory()?a.rmdir(b,c):a.unlink(b,c))})}function p(a,b,c,d){var f=e(a,b)&&(c?null:new s.EINVAL("New name not specified"));return f?d(f):t.dirname(b)!==t.dirname(c)?d(new s.EINVAL("New path name does not have the same parent as the old path")):void a.rename(b,c,d)}var q=a("MD5"),r=a("filer"),s=r.Errors,t=r.Path,u=a("../async-lite"),v=a("../fs-utils");b.exports={blockChecksums:k,getChecksum:l,rollData:j,generateChecksums:m,compareContents:n,configureOptions:c,findCallback:d,validateParams:e,del:o,rename:p}},{"../async-lite":8,"../fs-utils":14,MD5:23,filer:44}],20:[function(a,b){var c=a("../filer").Path,d=a("../async-lite"),e=a("../conflict"),f=a("./rsync-utils");b.exports=function g(a,b,h,i){function j(a,b){this.path=a,this.modified=b.mtime,this.size=b.size,this.type=b.type}function k(b,c){e.isConflictedCopy(a,b.path,function(a,d){return a?c(a):(d||p.push(b),void c(null,p))})}function l(e){return h.superficial?(p.push(new j(b,e)),i(null,p)):void a.readdir(b,function(f,l){function m(d,e){var f=c.join(b,d);a.lstat(f,function(b,c){if(b)return e(b);var d=new j(f,c);return h.recursive&&c.isDirectory()?void g(a,f,h,function(a,b){return a?e(a):(p=p.concat(b),void e())}):k(d,e)})}return f?i(f):(p.push(new j(b,e)),void d.eachSeries(l,m,function(a){return a?i(a):void i(null,p)}))})}function m(a){var c=new j(b,a);k(c,i)}function n(b){a.lstat(b,function(a,b){return a?i(a):b.isDirectory()?void l(b):m(b)})}i=f.findCallback(i,h);var o=f.validateParams(a,b);if(o)return i(o);h=f.configureOptions(h);var p=[];n(b)}},{"../async-lite":8,"../conflict":9,"../filer":13,"./rsync-utils":19}],21:[function(a,b){function c(a,b,d){if(!c.isValidType(a))throw"Invalid type";if(!c.isValidName(b))throw"Invalid name";this.type=a,this.name=b,this.content=d||null;var e=this;this.is={get request(){return e.type===c.REQUEST},get response(){return e.type===c.RESPONSE},get error(){return e.type===c.ERROR},get sourceList(){return e.name===c.SOURCELIST},get sync(){return e.name===c.SYNC},get checksums(){return e.name===c.CHECKSUMS},get diffs(){return e.name===c.DIFFS},get patch(){return e.name===c.PATCH},get verification(){return e.name===c.VERIFICATION},get reset(){return e.name===c.RESET},get locked(){return e.name===c.LOCKED},get authz(){return e.name===c.AUTHZ},get impl(){return e.name===c.IMPL},get content(){return e.name===c.INCONT},get serverReset(){return e.name===c.SERVER_RESET},get downstreamLocked(){return e.name===c.DOWNSTREAM_LOCKED},get fileSizeError(){return e.type===c.ERROR&&e.name===c.MAXSIZE},get root(){return e.name===c.ROOT},get needsDownstream(){return e.type===c.ERROR&&e.name===c.NEEDS_DOWNSTREAM},get interrupted(){return e.name===c.INTERRUPTED},get delay(){return e.type===c.REQUEST&&e.name===c.DELAY},get rename(){return e.name===c.RENAME},get del(){return e.name===c.DEL}}}c.isValidName=function(a){return a===c.SOURCELIST||a===c.CHECKSUMS||a===c.DIFFS||a===c.LOCKED||a===c.PATCH||a===c.VERIFICATION||a===c.SYNC||a===c.RESET||a===c.AUTHZ||a===c.IMPL||a===c.INFRMT||a===c.INCONT||a===c.SERVER_RESET||a===c.DOWNSTREAM_LOCKED||a===c.MAXSIZE||a===c.ROOT||a===c.NEEDS_DOWNSTREAM||a===c.INTERRUPTED||a===c.DELAY||a===c.RENAME||a===c.DEL},c.isValidType=function(a){return a===c.REQUEST||a===c.RESPONSE||a===c.ERROR},c.prototype.stringify=function(){return JSON.stringify({type:this.type,name:this.name,content:this.content})},c.parse=function(a){return a&&c.isValidType(a.type)&&c.isValidName(a.name)?new c(a.type,a.name,a.content):c.error.format},c.REQUEST="REQUEST",c.RESPONSE="RESPONSE",c.ERROR="ERROR",c.SOURCELIST="SOURCELIST",c.SYNC="SYNC",c.CHECKSUMS="CHECKSUMS",c.DIFFS="DIFFS",c.PATCH="PATCH",c.VERIFICATION="VERIFICATION",c.RESET="RESET",c.LOCKED="LOCKED",c.AUTHZ="AUTHORIZED",c.IMPL="IMPLEMENTATION",c.SERVER_RESET="SERVER_RESET",c.DOWNSTREAM_LOCKED="DOWNSTREAM_LOCKED",c.MAXSIZE="MAXSIZE",c.INTERRUPTED="INTERRUPTED",c.ROOT="ROOT",c.NEEDS_DOWNSTREAM="NEEDS DOWNSTREAM",c.DELAY="DELAY DOWNSTREAM",c.RENAME="RENAME",c.DEL="DELETE",c.INFRMT="INVALID FORMAT",c.INCONT="INVALID CONTENT",c.request={get diffs(){return new c(c.REQUEST,c.DIFFS)},get checksums(){return new c(c.REQUEST,c.CHECKSUMS)},get sync(){return new c(c.REQUEST,c.SYNC)},get reset(){return new c(c.REQUEST,c.RESET)},get delay(){return new c(c.REQUEST,c.DELAY)},get rename(){return new c(c.REQUEST,c.RENAME)},get del(){return new c(c.REQUEST,c.DEL)}},c.response={get diffs(){return new c(c.RESPONSE,c.DIFFS)},get patch(){return new c(c.RESPONSE,c.PATCH)},get verification(){return new c(c.RESPONSE,c.VERIFICATION)},get authz(){return new c(c.RESPONSE,c.AUTHZ)},get sync(){return new c(c.RESPONSE,c.SYNC)},get reset(){return new c(c.RESPONSE,c.RESET)},get root(){return new c(c.RESPONSE,c.ROOT)}},c.error={get sourceList(){return new c(c.ERROR,c.SOURCELIST)},get diffs(){return new c(c.ERROR,c.DIFFS)},get locked(){return new c(c.ERROR,c.LOCKED)},get checksums(){return new c(c.ERROR,c.CHECKSUMS)},get patch(){return new c(c.ERROR,c.PATCH)},get impl(){return new c(c.ERROR,c.IMPL)},get serverReset(){return new c(c.ERROR,c.SERVER_RESET)},get downstreamLocked(){return new c(c.ERROR,c.DOWNSTREAM_LOCKED,"Downstream syncs are locked!")},get maxsizeExceeded(){return new c(c.ERROR,c.MAXSIZE,"Maximum file size exceeded")},get verification(){return new c(c.ERROR,c.VERIFICATION,"Patch could not be verified")},get format(){return new c(c.ERROR,c.INFRMT,"Message must be formatted as a sync message")},get content(){return new c(c.ERROR,c.INCONT,"Invalid content provided")},get interrupted(){return new c(c.ERROR,c.INTERRUPTED)},get needsDownstream(){return new c(c.ERROR,c.NEEDS_DOWNSTREAM)},get rename(){return new c(c.ERROR,c.RENAME)},get del(){return new c(c.ERROR,c.DEL)}},c.prototype.invalidContent=function(a){var b=this.content;if(a=a||[],!b||!b.path)return!0;for(var c=0;c<a.length;c++)if(!b[a[c]])return!0;return!1},b.exports=c},{}],22:[function(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(a[c].path===b)return c;return-1}b.exports={findPathIndexInArray:c}},{}],23:[function(a,b){(function(c){!function(){var d=a("crypt"),e=a("charenc").utf8,f=a("charenc").bin,g=function(a,b){a.constructor==String?a=b&&"binary"===b.encoding?f.stringToBytes(a):e.stringToBytes(a):"undefined"!=typeof c&&"function"==typeof c.isBuffer&&c.isBuffer(a)?a=Array.prototype.slice.call(a,0):Array.isArray(a)||(a=a.toString());for(var h=d.bytesToWords(a),i=8*a.length,j=1732584193,k=-271733879,l=-1732584194,m=271733878,n=0;n<h.length;n++)h[n]=16711935&(h[n]<<8|h[n]>>>24)|4278255360&(h[n]<<24|h[n]>>>8);h[i>>>5]|=128<<i%32,h[(i+64>>>9<<4)+14]=i;for(var o=g._ff,p=g._gg,q=g._hh,r=g._ii,n=0;n<h.length;n+=16){var s=j,t=k,u=l,v=m;j=o(j,k,l,m,h[n+0],7,-680876936),m=o(m,j,k,l,h[n+1],12,-389564586),l=o(l,m,j,k,h[n+2],17,606105819),k=o(k,l,m,j,h[n+3],22,-1044525330),j=o(j,k,l,m,h[n+4],7,-176418897),m=o(m,j,k,l,h[n+5],12,1200080426),l=o(l,m,j,k,h[n+6],17,-1473231341),k=o(k,l,m,j,h[n+7],22,-45705983),j=o(j,k,l,m,h[n+8],7,1770035416),m=o(m,j,k,l,h[n+9],12,-1958414417),l=o(l,m,j,k,h[n+10],17,-42063),k=o(k,l,m,j,h[n+11],22,-1990404162),j=o(j,k,l,m,h[n+12],7,1804603682),m=o(m,j,k,l,h[n+13],12,-40341101),l=o(l,m,j,k,h[n+14],17,-1502002290),k=o(k,l,m,j,h[n+15],22,1236535329),j=p(j,k,l,m,h[n+1],5,-165796510),m=p(m,j,k,l,h[n+6],9,-1069501632),l=p(l,m,j,k,h[n+11],14,643717713),k=p(k,l,m,j,h[n+0],20,-373897302),j=p(j,k,l,m,h[n+5],5,-701558691),m=p(m,j,k,l,h[n+10],9,38016083),l=p(l,m,j,k,h[n+15],14,-660478335),k=p(k,l,m,j,h[n+4],20,-405537848),j=p(j,k,l,m,h[n+9],5,568446438),m=p(m,j,k,l,h[n+14],9,-1019803690),l=p(l,m,j,k,h[n+3],14,-187363961),k=p(k,l,m,j,h[n+8],20,1163531501),j=p(j,k,l,m,h[n+13],5,-1444681467),m=p(m,j,k,l,h[n+2],9,-51403784),l=p(l,m,j,k,h[n+7],14,1735328473),k=p(k,l,m,j,h[n+12],20,-1926607734),j=q(j,k,l,m,h[n+5],4,-378558),m=q(m,j,k,l,h[n+8],11,-2022574463),l=q(l,m,j,k,h[n+11],16,1839030562),k=q(k,l,m,j,h[n+14],23,-35309556),j=q(j,k,l,m,h[n+1],4,-1530992060),m=q(m,j,k,l,h[n+4],11,1272893353),l=q(l,m,j,k,h[n+7],16,-155497632),k=q(k,l,m,j,h[n+10],23,-1094730640),j=q(j,k,l,m,h[n+13],4,681279174),m=q(m,j,k,l,h[n+0],11,-358537222),l=q(l,m,j,k,h[n+3],16,-722521979),k=q(k,l,m,j,h[n+6],23,76029189),j=q(j,k,l,m,h[n+9],4,-640364487),m=q(m,j,k,l,h[n+12],11,-421815835),l=q(l,m,j,k,h[n+15],16,530742520),k=q(k,l,m,j,h[n+2],23,-995338651),j=r(j,k,l,m,h[n+0],6,-198630844),m=r(m,j,k,l,h[n+7],10,1126891415),l=r(l,m,j,k,h[n+14],15,-1416354905),k=r(k,l,m,j,h[n+5],21,-57434055),j=r(j,k,l,m,h[n+12],6,1700485571),m=r(m,j,k,l,h[n+3],10,-1894986606),l=r(l,m,j,k,h[n+10],15,-1051523),k=r(k,l,m,j,h[n+1],21,-2054922799),j=r(j,k,l,m,h[n+8],6,1873313359),m=r(m,j,k,l,h[n+15],10,-30611744),l=r(l,m,j,k,h[n+6],15,-1560198380),k=r(k,l,m,j,h[n+13],21,1309151649),j=r(j,k,l,m,h[n+4],6,-145523070),m=r(m,j,k,l,h[n+11],10,-1120210379),l=r(l,m,j,k,h[n+2],15,718787259),k=r(k,l,m,j,h[n+9],21,-343485551),j=j+s>>>0,k=k+t>>>0,l=l+u>>>0,m=m+v>>>0}return d.endian([j,k,l,m])};g._ff=function(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._gg=function(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._hh=function(a,b,c,d,e,f,g){var h=a+(b^c^d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._ii=function(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._blocksize=16,g._digestsize=16,b.exports=function(a,b){if("undefined"!=typeof a){var c=d.wordsToBytes(g(a,b));return b&&b.asBytes?c:b&&b.asString?f.bytesToString(c):d.bytesToHex(c)}}}()}).call(this,a("buffer").Buffer)},{buffer:57,charenc:24,crypt:25}],24:[function(a,b){var c={utf8:{stringToBytes:function(a){return c.bin.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(c.bin.bytesToString(a)))}},bin:{stringToBytes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b},bytesToString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}}};b.exports=c},{}],25:[function(a,b){!function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c={rotl:function(a,b){return a<<b|a>>>32-b},rotr:function(a,b){return a<<32-b|a>>>b},endian:function(a){if(a.constructor==Number)return 16711935&c.rotl(a,8)|4278255360&c.rotl(a,24);for(var b=0;b<a.length;b++)a[b]=c.endian(a[b]);return a},randomBytes:function(a){for(var b=[];a>0;a--)b.push(Math.floor(256*Math.random()));return b},bytesToWords:function(a){for(var b=[],c=0,d=0;c<a.length;c++,d+=8)b[d>>>5]|=a[c]<<24-d%32;return b},wordsToBytes:function(a){for(var b=[],c=0;c<32*a.length;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b},bytesToHex:function(a){for(var b=[],c=0;c<a.length;c++)b.push((a[c]>>>4).toString(16)),b.push((15&a[c]).toString(16));return b.join("")},hexToBytes:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},bytesToBase64:function(b){for(var c=[],d=0;d<b.length;d+=3)for(var e=b[d]<<16|b[d+1]<<8|b[d+2],f=0;4>f;f++)c.push(8*d+6*f<=8*b.length?a.charAt(e>>>6*(3-f)&63):"=");return c.join("")},base64ToBytes:function(b){b=b.replace(/[^A-Z0-9+\/]/gi,"");for(var c=[],d=0,e=0;d<b.length;e=++d%4)0!=e&&c.push((a.indexOf(b.charAt(d-1))&Math.pow(2,-2*e+8)-1)<<2*e|a.indexOf(b.charAt(d))>>>6-2*e);return c}};b.exports=c}()},{}],26:[function(b,c,d){!function(b,e){"function"==typeof a&&a.amd?a([],e):"object"==typeof d?c.exports=e():b.returnExports=e()}(this,function(){function a(e,f){if("function"!=typeof f)throw new Error("Bad callback given: "+f);if(!e)throw new Error("No options given");var h=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=h,e.verbose&&(a.log=d()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var i=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<i.length;j++)if(e[i[j]])throw new Error("options."+i[j]+" is not supported");if(e.callback=f,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||a.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)));var k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(e.qs){var l="string"==typeof e.qs?e.qs:k(e.qs);e.uri=-1!==e.uri.indexOf("?")?e.uri+"&"+l:e.uri+"?"+l}var m=function(a){var b={};b.boundry="-------------------------------"+Math.floor(1e9*Math.random());var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push("--"+b.boundry+'\nContent-Disposition: form-data; name="'+d+'"\n\n'+a[d]+"\n");return c.push("--"+b.boundry+"--"),b.body=c.join(""),b.length=b.body.length,b.type="multipart/form-data; boundary="+b.boundry,b};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var n=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=n,n){case"application/x-www-form-urlencoded":e.body=k(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var o=m(e.form);e.body=o.body,e.headers["content-type"]=o.type;break;default:throw new Error("unsupported encoding:"+n)}}}return e.onResponse=e.onResponse||c,e.onResponse===!0&&(e.onResponse=f,e.callback=c),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+g(e.auth.username+":"+e.auth.password)),b(e)}function b(b){function c(){l=!0;var c=new Error("ETIMEDOUT");return c.code="ETIMEDOUT",c.duration=b.timeout,a.log.error("Timeout",{id:k._id,milliseconds:b.timeout}),b.callback(c,k)}function d(){if(l)return a.log.debug("Ignoring timed out state change",{state:k.readyState,id:k.id});if(a.log.debug("State change",{state:k.readyState,id:k.id,timed_out:l}),k.readyState===h.OPENED){a.log.debug("Request started",{id:k.id});for(var c in b.headers)k.setRequestHeader(c,b.headers[c])}else k.readyState===h.HEADERS_RECEIVED?e():k.readyState===h.LOADING?(e(),g()):k.readyState===h.DONE&&(e(),g(),i())}function e(){if(!p.response){if(p.response=!0,a.log.debug("Got response",{id:k.id,status:k.status}),clearTimeout(k.timeoutTimer),k.statusCode=k.status,m&&0==k.statusCode){var c=new Error("CORS request rejected: "+b.uri);return c.cors="rejected",p.loading=!0,p.end=!0,b.callback(c,k)}b.onResponse(null,k)}}function g(){p.loading||(p.loading=!0,a.log.debug("Response body loading",{id:k.id}))}function i(){if(!p.end){if(p.end=!0,a.log.debug("Request done",{id:k.id}),k.body=k.responseText,b.json)try{k.body=JSON.parse(k.responseText)}catch(c){return b.callback(c,k)}b.callback(null,k,k.body)}}var k=new h,l=!1,m=f(b.uri),n="withCredentials"in k;if(j+=1,k.seq_id=j,k.id=j+": "+b.method+" "+b.uri,k._id=k.id,m&&!n){var o=new Error("Browser does not support cross-origin request: "+b.uri);return o.cors="unsupported",b.callback(o,k)}k.timeoutTimer=setTimeout(c,b.timeout);var p={response:!1,loading:!1,end:!1};return k.onreadystatechange=d,k.open(b.method,b.uri,!0),m&&(k.withCredentials=!!b.withCredentials),k.send(b.body),k}function c(){}function d(){var a,b,d={},f=["trace","debug","info","warn","error"];for(b=0;b<f.length;b++)a=f[b],d[a]=c,"undefined"!=typeof console&&console&&console[a]&&(d[a]=e(console,a));return d}function e(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function f(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function g(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var h=XMLHttpRequest;if(!h)throw new Error("missing XMLHttpRequest");a.log={trace:c,debug:c,info:c,warn:c,error:c};var i=18e4,j=0;a.withCredentials=!1,a.DEFAULT_TIMEOUT=i,a.defaults=function(b){var c=function(a){var c=function(c,d){c="string"==typeof c?{uri:c}:JSON.parse(JSON.stringify(c));for(var e in b)void 0===c[e]&&(c[e]=b[e]);return a(c,d)};return c},d=c(a);return d.get=c(a.get),d.post=c(a.post),d.put=c(a.put),d.head=c(a.head),d};var k=["get","put","post","head"];return k.forEach(function(b){var c=b.toUpperCase(),d=b.toLowerCase();a[d]=function(b){"string"==typeof b?b={method:c,uri:b}:(b=JSON.parse(JSON.stringify(b)),b.method=c);var d=[b].concat(Array.prototype.slice.apply(arguments,[1]));return a.apply(this,d)}}),a.couch=function(b,d){function e(a,b,c){if(a)return d(a,b,c);if((b.statusCode<200||b.statusCode>299)&&c.error){a=new Error("CouchDB error: "+(c.error.reason||c.error.error));for(var e in c)a[e]=c[e];return d(a,b,c)}return d(a,b,c)}"string"==typeof b&&(b={uri:b}),b.json=!0,b.body&&(b.json=b.body),delete b.body,d=d||c;var f=a(b,e);return f},a})},{}],27:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],28:[function(b,c){(function(b){!function(){var d={};"undefined"!=typeof b&&b.nextTick?(d.nextTick=b.nextTick,d.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:d.nextTick):"function"==typeof setImmediate?(d.nextTick=function(a){setImmediate(a)},d.setImmediate=d.nextTick):(d.nextTick=function(a){setTimeout(a,0)},d.setImmediate=d.nextTick),d.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},d.forEachSeries=d.eachSeries,"undefined"!=typeof a&&a.amd?a([],function(){return d}):"undefined"!=typeof c&&c.exports?c.exports=d:root.async=d}()}).call(this,b("_process"))},{_process:62}],29:[function(a,b){function c(a,b){for(var c=b.length-1;c>=0;c--)b[c]===a&&b.splice(c,1);return b}var d=function(){};d.createInterface=function(a){var b={};return b.on=function(b,c){"undefined"==typeof this[a]&&(this[a]={}),this[a].hasOwnProperty(b)||(this[a][b]=[]),this[a][b].push(c)},b.off=function(b,d){"undefined"!=typeof this[a]&&this[a].hasOwnProperty(b)&&c(d,this[a][b])},b.trigger=function(b){if("undefined"!=typeof this[a]&&this[a].hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),d=0;d<this[a][b].length;d++)this[a][b][d].apply(this[a][b][d],c)},b.removeAllListeners=function(b){if("undefined"!=typeof this[a]){var c=this;c[a][b].forEach(function(a){c.off(b,a)})}},b};var e=d.createInterface("_handlers");d.prototype._on=e.on,d.prototype._off=e.off,d.prototype._trigger=e.trigger;var f=d.createInterface("handlers");d.prototype.on=function(){f.on.apply(this,arguments),Array.prototype.unshift.call(arguments,"on"),this._trigger.apply(this,arguments)},d.prototype.off=f.off,d.prototype.trigger=f.trigger,d.prototype.removeAllListeners=f.removeAllListeners,b.exports=d},{}],30:[function(a,b){(function(c){function d(a,b){var c=0;return function(){var d=Date.now();d-c>a&&(c=d,b.apply(this,arguments))}}function e(a,b){if("undefined"!=typeof a&&a||(a={}),"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function f(){var a=this,b=Date.now();this.origin=h(),this.lastMessage=b,this.receivedIDs={},this.previousValues={};var d=function(){a._onStorageEvent.apply(a,arguments)};"undefined"!=typeof document&&(document.attachEvent?document.attachEvent("onstorage",d):c.addEventListener("storage",d,!1))}var g=a("./eventemitter.js"),h=a("../src/shared.js").guid,i=function(a){return"undefined"==typeof a||"undefined"==typeof a.localStorage?{getItem:function(){},setItem:function(){},removeItem:function(){}}:a.localStorage}(c);f.prototype._transaction=function(a){function b(){if(!g){var k=Date.now(),m=0|i.getItem(l);if(m&&d>k-m)return h||(f._on("storage",b),h=!0),void(j=setTimeout(b,e));g=!0,i.setItem(l,k),a(),c()}}function c(){h&&f._off("storage",b),j&&clearTimeout(j),i.removeItem(l)}var d=1e3,e=20,f=this,g=!1,h=!1,j=null;b()},f.prototype._cleanup_emit=d(100,function(){var a=this;a._transaction(function(){var a,b=Date.now(),c=b-m,d=0;try{a=JSON.parse(i.getItem(j)||"[]")}catch(e){a=[]}for(var f=a.length-1;f>=0;f--)a[f].timestamp<c&&(a.splice(f,1),d++);d>0&&i.setItem(j,JSON.stringify(a))})}),f.prototype._cleanup_once=d(100,function(){var a=this;a._transaction(function(){var b,c,d=(Date.now(),0);try{c=JSON.parse(i.getItem(k)||"{}")}catch(e){c={}}for(b in c)a._once_expired(b,c)&&(delete c[b],d++);d>0&&i.setItem(k,JSON.stringify(c))})}),f.prototype._once_expired=function(a,b){if(!b)return!0;if(!b.hasOwnProperty(a))return!0;if("object"!=typeof b[a])return!0;var c=b[a].ttl||n,d=Date.now(),e=b[a].timestamp;return d-c>e},f.prototype._localStorageChanged=function(a,b){if(a&&a.key)return a.key===b;var c=i.getItem(b);return c===this.previousValues[b]?!1:(this.previousValues[b]=c,!0)},f.prototype._onStorageEvent=function(a){a=a||c.event;var b=this;this._localStorageChanged(a,j)&&this._transaction(function(){var a,c=Date.now(),d=i.getItem(j);try{a=JSON.parse(d||"[]")}catch(e){a=[]}for(var f=0;f<a.length;f++)if(a[f].origin!==b.origin&&!(a[f].timestamp<b.lastMessage)){if(a[f].id){if(b.receivedIDs.hasOwnProperty(a[f].id))continue;b.receivedIDs[a[f].id]=!0}b.trigger(a[f].name,a[f].payload)}b.lastMessage=c}),this._trigger("storage",a)},f.prototype._emit=function(a,b,c){if(c="string"==typeof c||"number"==typeof c?String(c):null,c&&c.length){if(this.receivedIDs.hasOwnProperty(c))return;this.receivedIDs[c]=!0}var d={id:c,name:a,origin:this.origin,timestamp:Date.now(),payload:b},e=this;this._transaction(function(){var c=i.getItem(j)||"[]",f="[]"===c?"":",";c=[c.substring(0,c.length-1),f,JSON.stringify(d),"]"].join(""),i.setItem(j,c),e.trigger(a,b),setTimeout(function(){e._cleanup_emit()},50)
})},f.prototype.emit=function(a,b){this._emit.apply(this,arguments),this._trigger("emit",a,b)},f.prototype.once=function(a,b,c){if(f.supported){var d=this;this._transaction(function(){var e;try{e=JSON.parse(i.getItem(k)||"{}")}catch(f){e={}}d._once_expired(a,e)&&(e[a]={},e[a].timestamp=Date.now(),"number"==typeof c&&(e[a].ttl=1e3*c),i.setItem(k,JSON.stringify(e)),b(),setTimeout(function(){d._cleanup_once()},50))})}},e(f.prototype,g.prototype),f.supported="undefined"!=typeof i;var j="intercom",k="intercom_once",l="intercom_lock",m=5e4,n=36e5;f.destroy=function(){i.removeItem(l),i.removeItem(j),i.removeItem(k)},f.getInstance=function(){var a;return function(){return a||(a=new f),a}}(),b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../src/shared.js":52,"./eventemitter.js":29}],31:[function(a,b){function c(a,b){return p.call(a,b)}function d(a){return null==a?0:a.length===+a.length?a.length:s(a).length}function e(a){return a}function f(a,b,c){var d,e;if(null!=a)if(l&&a.forEach===l)a.forEach(b,c);else if(a.length===+a.length){for(d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===r)return}else{var f=f(a);for(d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===r)return}}function g(a,b,c){b||(b=e);var d=!1;return null==a?d:n&&a.some===n?a.some(b,c):(f(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?r:void 0}),!!d)}function h(a,b){return null==a?!1:m&&a.indexOf===m?-1!=a.indexOf(b):g(a,function(a){return a===b})}function i(a){this.value=a}function j(a){return a&&"object"==typeof a&&!Array.isArray(a)&&p.call(a,"__wrapped__")?a:new i(a)}var k=Array.prototype,l=k.forEach,m=k.indexOf,n=k.some,o=Object.prototype,p=o.hasOwnProperty,q=Object.keys,r={},s=q||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var d in a)c(a,d)&&b.push(d);return b};i.prototype.has=function(a){return c(this.value,a)},i.prototype.contains=function(a){return h(this.value,a)},i.prototype.size=function(){return d(this.value)},b.exports=j},{}],32:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],33:[function(a,b){(function(c){!function(a,b,c,d){function e(a){return a.split("").reduce(function(a,b){return a[b]=!0,a},{})}function f(a,b){return b=b||{},function(c){return h(c,a,b)}}function g(a,b){a=a||{},b=b||{};var c={};return Object.keys(b).forEach(function(a){c[a]=b[a]}),Object.keys(a).forEach(function(b){c[b]=a[b]}),c}function h(a,b,c){if("string"!=typeof b)throw new TypeError("glob pattern string required");return c||(c={}),c.nocomment||"#"!==b.charAt(0)?""===b.trim()?""===a:new i(b,c).match(a):!1}function i(a,b){if(!(this instanceof i))return new i(a,b,t);if("string"!=typeof a)throw new TypeError("glob pattern string required");b||(b={}),a=a.trim(),"win32"===d&&(a=a.split("\\").join("/"));var c=a+"\n"+v(b),e=h.cache.get(c);return e?e:(h.cache.set(c,this),this.options=b,this.set=[],this.pattern=a,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,void this.make())}function j(){if(!this._made){var a=this.pattern,b=this.options;if(!b.nocomment&&"#"===a.charAt(0))return void(this.comment=!0);if(!a)return void(this.empty=!0);this.parseNegate();var c=this.globSet=this.braceExpand();b.debug&&(this.debug=console.error),this.debug(this.pattern,c),c=this.globParts=c.map(function(a){return a.split(B)}),this.debug(this.pattern,c),c=c.map(function(a){return a.map(this.parse,this)},this),this.debug(this.pattern,c),c=c.filter(function(a){return-1===a.indexOf(!1)}),this.debug(this.pattern,c),this.set=c}}function k(){var a=this.pattern,b=!1,c=this.options,d=0;if(!c.nonegate){for(var e=0,f=a.length;f>e&&"!"===a.charAt(e);e++)b=!b,d++;d&&(this.pattern=a.substr(d)),this.negate=b}}function l(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function m(a,b){function c(){t.push(x),x=""}if(b=b||this.options,a="undefined"==typeof a?this.pattern:a,"undefined"==typeof a)throw new Error("undefined pattern");if(b.nobrace||!a.match(/\{.*\}/))return[a];var d=!1;if("{"!==a.charAt(0)){this.debug(a);for(var e=null,f=0,g=a.length;g>f;f++){var h=a.charAt(f);if(this.debug(f,h),"\\"===h)d=!d;else if("{"===h&&!d){e=a.substr(0,f);break}}if(null===e)return this.debug("no sets"),[a];var i=m.call(this,a.substr(f),b);return i.map(function(a){return e+a})}var j=a.match(/^\{(-?[0-9]+)\.\.(-?[0-9]+)\}/);if(j){this.debug("numset",j[1],j[2]);for(var k,n=m.call(this,a.substr(j[0].length),b),o=+j[1],p="0"===j[1][0],q=j[1].length,r=+j[2],s=o>r?-1:1,t=[],f=o;f!=r+s;f+=s){k=p?l(f,q):f+"";for(var u=0,v=n.length;v>u;u++)t.push(k+n[u])}return t}var f=1,w=1,t=[],x="",d=!1;this.debug("Entering for");a:for(f=1,g=a.length;g>f;f++){var h=a.charAt(f);if(this.debug("",f,h),d)d=!1,x+="\\"+h;else switch(h){case"\\":d=!0;continue;case"{":w++,x+="{";continue;case"}":if(w--,0===w){c(),f++;break a}x+=h;continue;case",":1===w?c():x+=h;continue;default:x+=h;continue}}if(0!==w)return this.debug("didn't close",a),m.call(this,"\\"+a,b);this.debug("set",t),this.debug("suffix",a.substr(f));var n=m.call(this,a.substr(f),b),y=1===t.length;this.debug("set pre-expanded",t),t=t.map(function(a){return m.call(this,a,b)},this),this.debug("set expanded",t),t=t.reduce(function(a,b){return a.concat(b)}),y&&(t=t.map(function(a){return"{"+a+"}"}));for(var z=[],f=0,g=t.length;g>f;f++)for(var u=0,v=n.length;v>u;u++)z.push(t[f]+n[u]);return z}function n(a,b){function c(){if(f){switch(f){case"*":h+=x,i=!0;break;case"?":h+=w,i=!0;break;default:h+="\\"+f}p.debug("clearStateChar %j %j",f,h),f=!1}}var d=this.options;if(!d.noglobstar&&"**"===a)return u;if(""===a)return"";for(var e,f,g,h="",i=!!d.nocase,j=!1,k=[],l=!1,m=-1,n=-1,o="."===a.charAt(0)?"":d.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",p=this,r=0,s=a.length;s>r&&(g=a.charAt(r));r++)if(this.debug("%s	%s %s %j",a,r,h,g),j&&A[g])h+="\\"+g,j=!1;else switch(g){case"/":return!1;case"\\":c(),j=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",a,r,h,g),l){this.debug("  in class"),"!"===g&&r===n+1&&(g="^"),h+=g;continue}p.debug("call clearStateChar %j",f),c(),f=g,d.noext&&c();continue;case"(":if(l){h+="(";continue}if(!f){h+="\\(";continue}e=f,k.push({type:e,start:r-1,reStart:h.length}),h+="!"===f?"(?:(?!":"(?:",this.debug("plType %j %j",f,h),f=!1;continue;case")":if(l||!k.length){h+="\\)";continue}switch(c(),i=!0,h+=")",e=k.pop().type){case"!":h+="[^/]*?)";break;case"?":case"+":case"*":h+=e;case"@":}continue;case"|":if(l||!k.length||j){h+="\\|",j=!1;continue}c(),h+="|";continue;case"[":if(c(),l){h+="\\"+g;continue}l=!0,n=r,m=h.length,h+=g;continue;case"]":if(r===n+1||!l){h+="\\"+g,j=!1;continue}i=!0,l=!1,h+=g;continue;default:c(),j?j=!1:!A[g]||"^"===g&&l||(h+="\\"),h+=g}if(l){var t=a.substr(n+1),v=this.parse(t,C);h=h.substr(0,m)+"\\["+v[0],i=i||v[1]}for(var y;y=k.pop();){var z=h.slice(y.reStart+3);z=z.replace(/((?:\\{2})*)(\\?)\|/g,function(a,b,c){return c||(c="\\"),b+b+c+"|"}),this.debug("tail=%j\n   %s",z,z);var B="*"===y.type?x:"?"===y.type?w:"\\"+y.type;i=!0,h=h.slice(0,y.reStart)+B+"\\("+z}c(),j&&(h+="\\\\");var D=!1;switch(h.charAt(0)){case".":case"[":case"(":D=!0}if(""!==h&&i&&(h="(?=.)"+h),D&&(h=o+h),b===C)return[h,i];if(!i)return q(a);var E=d.nocase?"i":"",F=new RegExp("^"+h+"$",E);return F._glob=a,F._src=h,F}function o(){if(this.regexp||this.regexp===!1)return this.regexp;var a=this.set;if(!a.length)return this.regexp=!1;var b=this.options,c=b.noglobstar?x:b.dot?y:z,d=b.nocase?"i":"",e=a.map(function(a){return a.map(function(a){return a===u?c:"string"==typeof a?r(a):a._src}).join("\\/")}).join("|");e="^(?:"+e+")$",this.negate&&(e="^(?!"+e+").*$");try{return this.regexp=new RegExp(e,d)}catch(f){return this.regexp=!1}}function p(a,b){if(this.debug("match",a,this.pattern),this.comment)return!1;if(this.empty)return""===a;if("/"===a&&b)return!0;var c=this.options;"win32"===d&&(a=a.split("\\").join("/")),a=a.split(B),this.debug(this.pattern,"split",a);var e=this.set;this.debug(this.pattern,"set",e);for(var f,g=a.length-1;g>=0&&!(f=a[g]);g--);for(var g=0,h=e.length;h>g;g++){var i=e[g],j=a;c.matchBase&&1===i.length&&(j=[f]);var k=this.matchOne(j,i,b);if(k)return c.flipNegate?!0:!this.negate}return c.flipNegate?!1:this.negate}function q(a){return a.replace(/\\(.)/g,"$1")}function r(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}c?c.exports=h:b.minimatch=h,a||(a=function(a){switch(a){case"sigmund":return function(a){return JSON.stringify(a)};case"path":return{basename:function(a){a=a.split(/[\/\\]/);var b=a.pop();return b||(b=a.pop()),b}};case"lru-cache":return function(){var a={},b=0;this.set=function(c,d){b++,b>=100&&(a={}),a[c]=d},this.get=function(b){return a[b]}}}}),h.Minimatch=i;var s=a("lru-cache"),t=h.cache=new s({max:100}),u=h.GLOBSTAR=i.GLOBSTAR={},v=a("sigmund"),w=(a("path"),"[^/]"),x=w+"*?",y="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",z="(?:(?!(?:\\/|^)\\.).)*?",A=e("().*{}+?[]^$\\!"),B=/\/+/;h.filter=f,h.defaults=function(a){if(!a||!Object.keys(a).length)return h;var b=h,c=function(c,d,e){return b.minimatch(c,d,g(a,e))};return c.Minimatch=function(c,d){return new b.Minimatch(c,g(a,d))},c},i.defaults=function(a){return a&&Object.keys(a).length?h.defaults(a).Minimatch:i},i.prototype.debug=function(){},i.prototype.make=j,i.prototype.parseNegate=k,h.braceExpand=function(a,b){return new i(a,b).braceExpand()},i.prototype.braceExpand=m,i.prototype.parse=n;var C={};h.makeRe=function(a,b){return new i(a,b||{}).makeRe()},i.prototype.makeRe=o,h.match=function(a,b,c){c=c||{};var d=new i(b,c);return a=a.filter(function(a){return d.match(a)}),d.options.nonull&&!a.length&&a.push(b),a},i.prototype.match=p,i.prototype.matchOne=function(a,b,c){var d=this.options;this.debug("matchOne",{"this":this,file:a,pattern:b}),this.debug("matchOne",a.length,b.length);for(var e=0,f=0,g=a.length,h=b.length;g>e&&h>f;e++,f++){this.debug("matchOne loop");var i=b[f],j=a[e];if(this.debug(b,i,j),i===!1)return!1;if(i===u){this.debug("GLOBSTAR",[b,i,j]);var k=e,l=f+1;if(l===h){for(this.debug("** at the end");g>e;e++)if("."===a[e]||".."===a[e]||!d.dot&&"."===a[e].charAt(0))return!1;return!0}a:for(;g>k;){var m=a[k];if(this.debug("\nglobstar while",a,k,b,l,m),this.matchOne(a.slice(k),b.slice(l),c))return this.debug("globstar found match!",k,g,m),!0;if("."===m||".."===m||!d.dot&&"."===m.charAt(0)){this.debug("dot detected!",a,k,b,l);break a}this.debug("globstar swallow a segment, and continue"),k++}return c&&(this.debug("\n>>> no match, partial?",a,k,b,l),k===g)?!0:!1}var n;if("string"==typeof i?(n=d.nocase?j.toLowerCase()===i.toLowerCase():j===i,this.debug("string match",i,j,n)):(n=j.match(i),this.debug("pattern match",i,j,n)),!n)return!1}if(e===g&&f===h)return!0;if(e===g)return c;if(f===h){var o=e===g-1&&""===a[e];return o}throw new Error("wtf?")}}("function"==typeof a?a:null,this,"object"==typeof b?b:null,"object"==typeof c?c.platform:"win32")}).call(this,a("_process"))},{_process:62,"lru-cache":34,path:61,sigmund:35}],34:[function(a,b){!function(){function a(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c(){return 1}function d(a){return this instanceof d?("number"==typeof a&&(a={max:a}),a||(a={}),this._max=a.max,(!this._max||"number"!=typeof this._max||this._max<=0)&&(this._max=1/0),this._lengthCalculator=a.length||c,"function"!=typeof this._lengthCalculator&&(this._lengthCalculator=c),this._allowStale=a.stale||!1,this._maxAge=a.maxAge||null,this._dispose=a.dispose,void this.reset()):new d(a)}function e(a,b,c){var d=a._cache[b];return d&&(a._maxAge&&Date.now()-d.now>a._maxAge?(i(a,d),a._allowStale||(d=void 0)):c&&f(a,d),d&&(d=d.value)),d}function f(a,b){h(a,b),b.lu=a._mru++,a._lruList[b.lu]=b}function g(a){for(;a._lru<a._mru&&a._length>a._max;)i(a,a._lruList[a._lru])}function h(a,b){for(delete a._lruList[b.lu];a._lru<a._mru&&!a._lruList[a._lru];)a._lru++}function i(a,b){b&&(a._dispose&&a._dispose(b.key,b.value),a._length-=b.length,a._itemCount--,delete a._cache[b.key],h(a,b))}function j(a,b,c,d,e){this.key=a,this.value=b,this.lu=c,this.length=d,this.now=e}"object"==typeof b&&b.exports?b.exports=d:this.LRUCache=d,Object.defineProperty(d.prototype,"max",{set:function(a){(!a||"number"!=typeof a||0>=a)&&(a=1/0),this._max=a,this._length>this._max&&g(this)},get:function(){return this._max},enumerable:!0}),Object.defineProperty(d.prototype,"lengthCalculator",{set:function(a){if("function"!=typeof a){this._lengthCalculator=c,this._length=this._itemCount;for(var b in this._cache)this._cache[b].length=1}else{this._lengthCalculator=a,this._length=0;for(var b in this._cache)this._cache[b].length=this._lengthCalculator(this._cache[b].value),this._length+=this._cache[b].length}this._length>this._max&&g(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(d.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),d.prototype.forEach=function(a,b){b=b||this;for(var c=0,d=this._mru-1;d>=0&&c<this._itemCount;d--)if(this._lruList[d]){c++;var e=this._lruList[d];this._maxAge&&Date.now()-e.now>this._maxAge&&(i(this,e),this._allowStale||(e=void 0)),e&&a.call(b,e.value,e.key,this)}},d.prototype.keys=function(){for(var a=new Array(this._itemCount),b=0,c=this._mru-1;c>=0&&b<this._itemCount;c--)if(this._lruList[c]){var d=this._lruList[c];a[b++]=d.key}return a},d.prototype.values=function(){for(var a=new Array(this._itemCount),b=0,c=this._mru-1;c>=0&&b<this._itemCount;c--)if(this._lruList[c]){var d=this._lruList[c];a[b++]=d.value}return a},d.prototype.reset=function(){if(this._dispose&&this._cache)for(var a in this._cache)this._dispose(a,this._cache[a].value);this._cache=Object.create(null),this._lruList=Object.create(null),this._mru=0,this._lru=0,this._length=0,this._itemCount=0},d.prototype.dump=function(){return this._cache},d.prototype.dumpLru=function(){return this._lruList},d.prototype.set=function(b,c){if(a(this._cache,b))return this._dispose&&this._dispose(b,this._cache[b].value),this._maxAge&&(this._cache[b].now=Date.now()),this._cache[b].value=c,this.get(b),!0;var d=this._lengthCalculator(c),e=this._maxAge?Date.now():0,f=new j(b,c,this._mru++,d,e);return f.length>this._max?(this._dispose&&this._dispose(b,c),!1):(this._length+=f.length,this._lruList[f.lu]=this._cache[b]=f,this._itemCount++,this._length>this._max&&g(this),!0)},d.prototype.has=function(b){if(!a(this._cache,b))return!1;var c=this._cache[b];return this._maxAge&&Date.now()-c.now>this._maxAge?!1:!0},d.prototype.get=function(a){return e(this,a,!0)},d.prototype.peek=function(a){return e(this,a,!1)},d.prototype.pop=function(){var a=this._lruList[this._lru];return i(this,a),a||null},d.prototype.del=function(a){i(this,this._cache[a])}}()},{}],35:[function(a,b){function c(a,b){function c(a,g){return g>b||"function"==typeof a||"undefined"==typeof a?void 0:"object"!=typeof a||!a||a instanceof f?void(e+=a):void(-1===d.indexOf(a)&&g!==b&&(d.push(a),e+="{",Object.keys(a).forEach(function(b){if("_"!==b.charAt(0)){var d=typeof a[b];"function"!==d&&"undefined"!==d&&(e+=b,c(a[b],g+1))}})))}b=b||10;var d=[],e="",f=RegExp;return c(a,0),e}b.exports=c},{}],36:[function(a,b){(function(a){function c(b,c,d){return b instanceof ArrayBuffer&&(b=new Uint8Array(b)),new a(b,c,d)}c.prototype=Object.create(a.prototype),c.prototype.constructor=c,Object.keys(a).forEach(function(b){a.hasOwnProperty(b)&&(c[b]=a[b])}),b.exports=c}).call(this,a("buffer").Buffer)},{buffer:57}],37:[function(a,b){var c="READ",d="WRITE",e="CREATE",f="EXCLUSIVE",g="TRUNCATE",h="APPEND",i="CREATE",j="REPLACE";b.exports={FILE_SYSTEM_NAME:"local",FILE_STORE_NAME:"files",IDB_RO:"readonly",IDB_RW:"readwrite",WSQL_VERSION:"1",WSQL_SIZE:5242880,WSQL_DESC:"FileSystem Storage",MODE_FILE:"FILE",MODE_DIRECTORY:"DIRECTORY",MODE_SYMBOLIC_LINK:"SYMLINK",MODE_META:"META",SYMLOOP_MAX:10,BINARY_MIME_TYPE:"application/octet-stream",JSON_MIME_TYPE:"application/json",ROOT_DIRECTORY_NAME:"/",FS_FORMAT:"FORMAT",FS_NOCTIME:"NOCTIME",FS_NOMTIME:"NOMTIME",FS_NODUPEIDCHECK:"FS_NODUPEIDCHECK",O_READ:c,O_WRITE:d,O_CREATE:e,O_EXCLUSIVE:f,O_TRUNCATE:g,O_APPEND:h,O_FLAGS:{r:[c],"r+":[c,d],w:[d,e,g],"w+":[d,c,e,g],wx:[d,e,f,g],"wx+":[d,c,e,f,g],a:[d,e,h],"a+":[d,c,e,h],ax:[d,e,f,h],"ax+":[d,c,e,f,h]},XATTR_CREATE:i,XATTR_REPLACE:j,FS_READY:"READY",FS_PENDING:"PENDING",FS_ERROR:"ERROR",SUPER_NODE_ID:"00000000-0000-0000-0000-000000000000",STDIN:0,STDOUT:1,STDERR:2,FIRST_DESCRIPTOR:3,ENVIRONMENT:{TMP:"/tmp",PATH:""}}},{}],38:[function(a,b){var c=a("./constants.js").MODE_FILE;b.exports=function(a,b){this.id=a,this.type=b||c}},{"./constants.js":37}],39:[function(a,b){(function(a){function c(a){return a.toString("utf8")}function d(b){return new a(b,"utf8")}b.exports={encode:d,decode:c}}).call(this,a("buffer").Buffer)},{buffer:57}],40:[function(a,b){var c={};["9:EBADF:bad file descriptor","10:EBUSY:resource busy or locked","18:EINVAL:invalid argument","27:ENOTDIR:not a directory","28:EISDIR:illegal operation on a directory","34:ENOENT:no such file or directory","47:EEXIST:file already exists","50:EPERM:operation not permitted","51:ELOOP:too many symbolic links encountered","53:ENOTEMPTY:directory not empty","55:EIO:i/o error","1000:ENOTMOUNTED:not mounted","1001:EFILESYSTEMERROR:missing super node, use 'FORMAT' flag to format filesystem.","1002:ENOATTR:attribute does not exist"].forEach(function(a){function b(a,b){Error.call(this),this.name=e,this.code=e,this.errno=d,this.message=a||f,b&&(this.path=b),this.stack=new Error(this.message).stack}a=a.split(":");var d=+a[0],e=a[1],f=a[2];b.prototype=Object.create(Error.prototype),b.prototype.constructor=b,b.prototype.toString=function(){var a=this.path?", '"+this.path+"'":"";return this.name+": "+this.message+a},c[e]=c[d]=b}),b.exports=c},{}],41:[function(a,b){function c(a,b,c,d,e){function f(c){a.changes.push({event:"change",path:b}),e(c)}var g=a.flags;lb(g).contains(Jb)&&delete d.ctime,lb(g).contains(Ib)&&delete d.mtime;var h=!1;d.ctime&&(c.ctime=d.ctime,c.atime=d.ctime,h=!0),d.atime&&(c.atime=d.atime,h=!0),d.mtime&&(c.mtime=d.mtime,h=!0),h?a.putObject(c.id,c,f):f()}function d(a,b,d,f){function g(c,d){c?f(c):d.mode!==ub?f(new Lb.ENOTDIR("a component of the path prefix is not a directory",b)):(l=d,e(a,b,h))}function h(c,d){!c&&d?f(new Lb.EEXIST("path name already exists",b)):!c||c instanceof Lb.ENOENT?a.getObject(l.data,i):f(c)}function i(b,c){b?f(b):(m=c,Pb.create({guid:a.guid,mode:d},function(b,c){return b?void f(b):(n=c,n.nlinks+=1,void a.putObject(n.id,n,k))}))}function j(b){if(b)f(b);else{var d=Date.now();c(a,p,n,{mtime:d,ctime:d},f)}}function k(b){b?f(b):(m[o]=new Mb(n.id,d),a.putObject(l.data,m,j))}if(d!==ub&&d!==tb)return f(new Lb.EINVAL("mode must be a directory or file",b));b=nb(b);var l,m,n,o=pb(b),p=ob(b);e(a,p,g)}function e(a,b,c){function d(b,d){b?c(b):d&&d.mode===wb&&d.rnode?a.getObject(d.rnode,f):c(new Lb.EFILESYSTEMERROR)}function f(a,b){a?c(a):b?c(null,b):c(new Lb.ENOENT)}function g(d,e){d?c(d):e.mode===ub&&e.data?a.getObject(e.data,h):c(new Lb.ENOTDIR("a component of the path prefix is not a directory",b))}function h(d,e){if(d)c(d);else if(lb(e).has(k)){var f=e[k].id;a.getObject(f,i)}else c(new Lb.ENOENT(null,b))}function i(a,d){a?c(a):d.mode==vb?(m++,m>zb?c(new Lb.ELOOP(null,b)):j(d.data)):c(null,d)}function j(b){b=nb(b),l=ob(b),k=pb(b),xb==k?a.getObject(yb,d):e(a,l,g)}if(b=nb(b),!b)return c(new Lb.ENOENT("path is an empty string"));var k=pb(b),l=ob(b),m=0;xb==k?a.getObject(yb,d):e(a,l,g)}function f(a,b,d,e,f,g,h){function i(e){e?h(e):c(a,b,d,{ctime:Date.now()},h)}var j=d.xattrs;g===Gb&&j.hasOwnProperty(e)?h(new Lb.EEXIST("attribute already exists",b)):g!==Hb||j.hasOwnProperty(e)?(j[e]=f,a.putObject(d.id,d,i)):h(new Lb.ENOATTR(null,b))}function g(a,b){function c(c,e){!c&&e?b():!c||c instanceof Lb.ENOENT?Ob.create({guid:a.guid},function(c,e){return c?void b(c):(f=e,void a.putObject(f.id,f,d))}):b(c)}function d(c){c?b(c):Pb.create({guid:a.guid,id:f.rnode,mode:ub},function(c,d){return c?void b(c):(g=d,g.nlinks+=1,void a.putObject(g.id,g,e))})}function e(c){c?b(c):(h={},a.putObject(g.data,h,b))}var f,g,h;a.getObject(yb,c)}function h(a,b,d){function f(c,f){!c&&f?d(new Lb.EEXIST(null,b)):!c||c instanceof Lb.ENOENT?e(a,q,g):d(c)}function g(b,c){b?d(b):(n=c,a.getObject(n.data,h))}function h(b,c){b?d(b):(o=c,Pb.create({guid:a.guid,mode:ub},function(b,c){return b?void d(b):(l=c,l.nlinks+=1,void a.putObject(l.id,l,i))}))}function i(b){b?d(b):(m={},a.putObject(l.data,m,k))}function j(b){if(b)d(b);else{var e=Date.now();c(a,q,n,{mtime:e,ctime:e},d)}}function k(b){b?d(b):(o[p]=new Mb(l.id,ub),a.putObject(n.data,o,j))}b=nb(b);var l,m,n,o,p=pb(b),q=ob(b);e(a,b,f)}function i(a,b,d){function f(b,c){b?d(b):(p=c,a.getObject(p.data,g))}function g(c,e){c?d(c):xb==r?d(new Lb.EBUSY(null,b)):lb(e).has(r)?(q=e,n=q[r].id,a.getObject(n,h)):d(new Lb.ENOENT(null,b))}function h(c,e){c?d(c):e.mode!=ub?d(new Lb.ENOTDIR(null,b)):(n=e,a.getObject(n.data,i))}function i(a,c){a?d(a):(o=c,lb(o).size()>0?d(new Lb.ENOTEMPTY(null,b)):k())}function j(b){if(b)d(b);else{var e=Date.now();c(a,s,p,{mtime:e,ctime:e},l)}}function k(){delete q[r],a.putObject(p.data,q,j)}function l(b){b?d(b):a["delete"](n.id,m)}function m(b){b?d(b):a["delete"](n.data,d)}b=nb(b);var n,o,p,q,r=pb(b),s=ob(b);e(a,s,f)}function j(a,b,d,f){function g(c,d){c?f(c):d.mode!==ub?f(new Lb.ENOENT(null,b)):(q=d,a.getObject(q.data,h))}function h(c,e){c?f(c):(r=e,lb(r).has(v)?lb(d).contains(Db)?f(new Lb.ENOENT("O_CREATE and O_EXCLUSIVE are set, and the named file exists",b)):(s=r[v],s.type==ub&&lb(d).contains(Bb)?f(new Lb.EISDIR("the named file is a directory and O_WRITE is set",b)):a.getObject(s.id,i)):lb(d).contains(Cb)?l():f(new Lb.ENOENT("O_CREATE is not set and the named file does not exist",b)))}function i(a,c){if(a)f(a);else{var d=c;d.mode==vb?(x++,x>zb?f(new Lb.ELOOP(null,b)):j(d.data)):k(void 0,d)}}function j(c){c=nb(c),w=ob(c),v=pb(c),xb==v&&(lb(d).contains(Bb)?f(new Lb.EISDIR("the named file is a directory and O_WRITE is set",b)):e(a,b,k)),e(a,w,g)}function k(a,b){a?f(a):(t=b,f(null,t))}function l(){Pb.create({guid:a.guid,mode:tb},function(b,c){return b?void f(b):(t=c,t.nlinks+=1,void a.putObject(t.id,t,m))})}function m(b){b?f(b):(u=new Rb(0),u.fill(0),a.putBuffer(t.data,u,o))}function n(b){if(b)f(b);else{var d=Date.now();c(a,w,q,{mtime:d,ctime:d},p)}}function o(b){b?f(b):(r[v]=new Mb(t.id,tb),a.putObject(q.data,r,n))}function p(a){a?f(a):f(null,t)}b=nb(b);var q,r,s,t,u,v=pb(b),w=ob(b),x=0;xb==v?lb(d).contains(Bb)?f(new Lb.EISDIR("the named file is a directory and O_WRITE is set",b)):e(a,b,k):e(a,w,g)}function k(a,b,d,e,f,g){function h(a){a?g(a):g(null,f)}function i(d){if(d)g(d);else{var e=Date.now();c(a,b.path,l,{mtime:e,ctime:e},h)}}function j(b){b?g(b):a.putObject(l.id,l,i)}function k(c,h){if(c)g(c);else{l=h;var i=new Rb(f);i.fill(0),d.copy(i,0,e,e+f),b.position=f,l.size=f,l.version+=1,a.putBuffer(l.data,i,j)}}var l;a.getObject(b.id,k)}function l(a,b,d,e,f,g,h){function i(a){a?h(a):h(null,f)}function j(d){if(d)h(d);else{var e=Date.now();c(a,b.path,n,{mtime:e,ctime:e},i)}}function k(b){b?h(b):a.putObject(n.id,n,j)}function l(c,i){if(c)h(c);else{if(o=i,!o)return h(new Lb.EIO("Expected Buffer"));var j=void 0!==g&&null!==g?g:b.position,l=Math.max(o.length,j+f),m=new Rb(l);m.fill(0),o&&o.copy(m),d.copy(m,j,e,e+f),void 0===g&&(b.position+=f),n.size=l,n.version+=1,a.putBuffer(n.data,m,k)}}function m(b,c){b?h(b):(n=c,a.getBuffer(n.data,l))}var n,o;a.getObject(b.id,m)}function m(a,b,c,d,e,f,g){function h(a,h){if(a)g(a);else{if(k=h,!k)return g(new Lb.EIO("Expected Buffer"));var i=void 0!==f&&null!==f?f:b.position;e=i+e>c.length?e-i:e,k.copy(c,d,i,i+e),void 0===f&&(b.position+=e),g(null,e)}}function i(c,d){c?g(c):"DIRECTORY"===d.mode?g(new Lb.EISDIR("the named file is a directory",b.path)):(j=d,a.getBuffer(j.data,h))}var j,k;a.getObject(b.id,i)}function n(a,b,c){b=nb(b);pb(b);e(a,b,c)}function o(a,b,c){b.getNode(a,c)}function p(a,b,c){function d(b,d){b?c(b):(g=d,a.getObject(g.data,f))}function f(d,e){d?c(d):(h=e,lb(h).has(i)?a.getObject(h[i].id,c):c(new Lb.ENOENT("a component of the path does not name an existing file",b)))}b=nb(b);var g,h,i=pb(b),j=ob(b);xb==i?e(a,b,c):e(a,j,d)}function q(a,b,d,f){function g(b){b?f(b):c(a,d,t,{ctime:Date.now()},f)}function h(b,c){b?f(b):(t=c,t.nlinks+=1,a.putObject(t.id,t,g))}function i(b){b?f(b):a.getObject(s[u].id,h)}function j(b,c){b?f(b):(s=c,lb(s).has(u)?f(new Lb.EEXIST("newpath resolves to an existing file",u)):(s[u]=q[n],a.putObject(r.data,s,i)))}function k(b,c){b?f(b):(r=c,a.getObject(r.data,j))}function l(b,c){b?f(b):(q=c,lb(q).has(n)?e(a,v,k):f(new Lb.ENOENT("a component of either path prefix does not exist",n)))}function m(b,c){b?f(b):(p=c,a.getObject(p.data,l))}b=nb(b);var n=pb(b),o=ob(b);d=nb(d);var p,q,r,s,t,u=pb(d),v=ob(d);e(a,o,m)}function r(a,b,d){function f(b){b?d(b):(delete m[o],a.putObject(l.data,m,function(){var b=Date.now();c(a,p,l,{mtime:b,ctime:b},d)}))}function g(b){b?d(b):a["delete"](n.data,f)}function h(e,h){e?d(e):(n=h,n.nlinks-=1,n.nlinks<1?a["delete"](n.id,g):a.putObject(n.id,n,function(){c(a,b,n,{ctime:Date.now()},f)}))}function i(a,b){a?d(a):"DIRECTORY"===b.mode?d(new Lb.EPERM("unlink not permitted on directories",o)):h(null,b)}function j(b,c){b?d(b):(m=c,lb(m).has(o)?a.getObject(m[o].id,i):d(new Lb.ENOENT("a component of the path does not name an existing file",o)))}function k(b,c){b?d(b):(l=c,a.getObject(l.data,j))}b=nb(b);var l,m,n,o=pb(b),p=ob(b);e(a,p,k)}function s(a,b,c){function d(a,b){if(a)c(a);else{h=b;var d=Object.keys(h);c(null,d)}}function f(e,f){e?c(e):f.mode!==ub?c(new Lb.ENOTDIR(null,b)):(g=f,a.getObject(g.data,d))}b=nb(b);{var g,h;pb(b)}e(a,b,f)}function t(a,b,d,f){function g(b,c){b?f(b):(l=c,a.getObject(l.data,h))}function h(a,b){a?f(a):(m=b,lb(m).has(o)?f(new Lb.EEXIST(null,o)):i())}function i(){Pb.create({guid:a.guid,mode:vb},function(c,d){return c?void f(c):(n=d,n.nlinks+=1,n.size=b.length,n.data=b,void a.putObject(n.id,n,k))})}function j(b){if(b)f(b);else{var d=Date.now();c(a,p,l,{mtime:d,ctime:d},f)}}function k(b){b?f(b):(m[o]=new Mb(n.id,vb),a.putObject(l.data,m,j))}d=nb(d);var l,m,n,o=pb(d),p=ob(d);xb==o?f(new Lb.EEXIST(null,o)):e(a,p,g)}function u(a,b,c){function d(b,d){b?c(b):(h=d,a.getObject(h.data,f))}function f(b,d){b?c(b):(i=d,lb(i).has(j)?a.getObject(i[j].id,g):c(new Lb.ENOENT("a component of the path does not name an existing file",j)))}function g(a,d){a?c(a):d.mode!=vb?c(new Lb.EINVAL("path not a symbolic link",b)):c(null,d.data)}b=nb(b);var h,i,j=pb(b),k=ob(b);e(a,k,d)}function v(a,b,d,f){function g(c,d){c?f(c):d.mode==ub?f(new Lb.EISDIR(null,b)):(k=d,a.getBuffer(k.data,h))}function h(b,c){if(b)f(b);else{if(!c)return f(new Lb.EIO("Expected Buffer"));var e=new Rb(d);e.fill(0),c&&c.copy(e),a.putBuffer(k.data,e,j)}}function i(d){if(d)f(d);else{var e=Date.now();c(a,b,k,{mtime:e,ctime:e},f)}}function j(b){b?f(b):(k.size=d,k.version+=1,a.putObject(k.id,k,i))}b=nb(b);var k;0>d?f(new Lb.EINVAL("length cannot be negative")):e(a,b,g)}function w(a,b,d,e){function f(b,c){b?e(b):c.mode==ub?e(new Lb.EISDIR):(j=c,a.getBuffer(j.data,g))}function g(b,c){if(b)e(b);else{var f;if(!c)return e(new Lb.EIO("Expected Buffer"));c?f=c.slice(0,d):(f=new Rb(d),f.fill(0)),a.putBuffer(j.data,f,i)}}function h(d){if(d)e(d);else{var f=Date.now();c(a,b.path,j,{mtime:f,ctime:f},e)}}function i(b){b?e(b):(j.size=d,j.version+=1,a.putObject(j.id,j,h))}var j;0>d?e(new Lb.EINVAL("length cannot be negative")):b.getNode(a,f)}function x(a,b,d,f,g){function h(e,h){e?g(e):c(a,b,h,{atime:d,ctime:f,mtime:f},g)}b=nb(b),"number"!=typeof d||"number"!=typeof f?g(new Lb.EINVAL("atime and mtime must be number",b)):0>d||0>f?g(new Lb.EINVAL("atime and mtime must be positive integers",b)):e(a,b,h)}function y(a,b,d,e,f){function g(g,h){g?f(g):c(a,b.path,h,{atime:d,ctime:e,mtime:e},f)}"number"!=typeof d||"number"!=typeof e?f(new Lb.EINVAL("atime and mtime must be a number")):0>d||0>e?f(new Lb.EINVAL("atime and mtime must be positive integers")):b.getNode(a,g)}function z(a,b,c,d,g,h){function i(e,i){return e?h(e):void f(a,b,i,c,d,g,h)}b=nb(b),"string"!=typeof c?h(new Lb.EINVAL("attribute name must be a string",b)):c?null!==g&&g!==Gb&&g!==Hb?h(new Lb.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE",b)):e(a,b,i):h(new Lb.EINVAL("attribute name cannot be an empty string",b))}function A(a,b,c,d,e,g){function h(h,i){return h?g(h):void f(a,b.path,i,c,d,e,g)}"string"!=typeof c?g(new Lb.EINVAL("attribute name must be a string")):c?null!==e&&e!==Gb&&e!==Hb?g(new Lb.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE")):b.getNode(a,h):g(new Lb.EINVAL("attribute name cannot be an empty string"))}function B(a,b,c,d){function f(a,e){if(a)return d(a);var f=e.xattrs;f.hasOwnProperty(c)?d(null,f[c]):d(new Lb.ENOATTR(null,b))}b=nb(b),"string"!=typeof c?d(new Lb.EINVAL("attribute name must be a string",b)):c?e(a,b,f):d(new Lb.EINVAL("attribute name cannot be an empty string",b))}function C(a,b,c,d){function e(a,b){if(a)return d(a);var e=b.xattrs;e.hasOwnProperty(c)?d(null,e[c]):d(new Lb.ENOATTR)}"string"!=typeof c?d(new Lb.EINVAL):c?b.getNode(a,e):d(new Lb.EINVAL("attribute name cannot be an empty string"))}function D(a,b,d,f){function g(e,g){function h(d){d?f(d):c(a,b,g,{ctime:Date.now()},f)}if(e)return f(e);var i=g.xattrs;i.hasOwnProperty(d)?(delete i[d],a.putObject(g.id,g,h)):f(new Lb.ENOATTR(null,b))}b=nb(b),"string"!=typeof d?f(new Lb.EINVAL("attribute name must be a string",b)):d?e(a,b,g):f(new Lb.EINVAL("attribute name cannot be an empty string",b))}function E(a,b,d,e){function f(f,g){function h(d){d?e(d):c(a,b.path,g,{ctime:Date.now()},e)}if(f)return e(f);var i=g.xattrs;i.hasOwnProperty(d)?(delete i[d],a.putObject(g.id,g,h)):e(new Lb.ENOATTR)}"string"!=typeof d?e(new Lb.EINVAL("attribute name must be a string")):d?b.getNode(a,f):e(new Lb.EINVAL("attribute name cannot be an empty string"))}function F(a){return lb(Fb).has(a)?Fb[a]:null}function G(a,b,c){return a?"function"==typeof a?a={encoding:b,flag:c}:"string"==typeof a&&(a={encoding:a,flag:c}):a={encoding:b,flag:c},a}function H(a,b){var c;return a?rb(a)?c=new Lb.EINVAL("Path must be a string without null bytes.",a):qb(a)||(c=new Lb.EINVAL("Path must be absolute.",a)):c=new Lb.EINVAL("Path must be a string",a),c?(b(c),!1):!0}function I(a,b,c,d,e,f){function g(b,e){if(b)f(b);else{var g;g=lb(d).contains(Eb)?e.size:0;var h=new Nb(c,e.id,d,g),i=a.allocDescriptor(h);f(null,i)}}f=arguments[arguments.length-1],H(c,f)&&(d=F(d),d||f(new Lb.EINVAL("flags is not valid"),c),j(b,c,d,g))}function J(a,b,c,d){lb(a.openFiles).has(c)?(a.releaseDescriptor(c),d(null)):d(new Lb.EBADF)}function K(a,b,c,e,f){H(c,f)&&d(b,c,e,f)}function L(a,b,c,d,e){e=arguments[arguments.length-1],H(c,e)&&h(b,c,e)}function M(a,b,c,d){H(c,d)&&i(b,c,d)}function N(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Qb(c,a.name);d(null,e)}}H(c,d)&&n(b,c,e)}function O(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Qb(c,a.name);d(null,e)}}var f=a.openFiles[c];f?o(b,f,e):d(new Lb.EBADF)}function P(a,b,c,d,e){H(c,e)&&H(d,e)&&q(b,c,d,e)}function Q(a,b,c,d){H(c,d)&&r(b,c,d)}function R(a,b,c,d,e,f,g,h){function i(a,b){h(a,b||0,d)}e=void 0===e?0:e,f=void 0===f?d.length-e:f,h=arguments[arguments.length-1];var j=a.openFiles[c];j?lb(j.flags).contains(Ab)?m(b,j,d,e,f,g,i):h(new Lb.EBADF("descriptor does not permit reading")):h(new Lb.EBADF)}function S(a,b,c,d,e){if(e=arguments[arguments.length-1],d=G(d,null,"r"),H(c,e)){var f=F(d.flag||"r");
return f?void j(b,c,f,function(g,h){function i(){a.releaseDescriptor(k)}if(g)return e(g);var j=new Nb(c,h.id,f,0),k=a.allocDescriptor(j);o(b,j,function(f,g){if(f)return i(),e(f);var h=new Qb(g,a.name);if(h.isDirectory())return i(),e(new Lb.EISDIR("illegal operation on directory",c));var k=h.size,l=new Rb(k);l.fill(0),m(b,j,l,0,k,0,function(a){if(i(),a)return e(a);var b;b="utf8"===d.encoding?Kb.decode(l):l,e(null,b)})})}):e(new Lb.EINVAL("flags is not valid",c))}}function T(a,b,c,d,e,f,g,h){h=arguments[arguments.length-1],e=void 0===e?0:e,f=void 0===f?d.length-e:f;var i=a.openFiles[c];i?lb(i.flags).contains(Bb)?d.length-e<f?h(new Lb.EIO("intput buffer is too small")):l(b,i,d,e,f,g,h):h(new Lb.EBADF("descriptor does not permit writing")):h(new Lb.EBADF)}function U(a,b,c,d,e,f){if(f=arguments[arguments.length-1],e=G(e,"utf8","w"),H(c,f)){var g=F(e.flag||"w");if(!g)return f(new Lb.EINVAL("flags is not valid",c));d=d||"","number"==typeof d&&(d=""+d),"string"==typeof d&&"utf8"===e.encoding&&(d=Kb.encode(d)),j(b,c,g,function(e,h){if(e)return f(e);var i=new Nb(c,h.id,g,0),j=a.allocDescriptor(i);k(b,i,d,0,d.length,function(b){return a.releaseDescriptor(j),b?f(b):void f(null)})})}}function V(a,b,c,d,e,f){if(f=arguments[arguments.length-1],e=G(e,"utf8","a"),H(c,f)){var g=F(e.flag||"a");if(!g)return f(new Lb.EINVAL("flags is not valid",c));d=d||"","number"==typeof d&&(d=""+d),"string"==typeof d&&"utf8"===e.encoding&&(d=Kb.encode(d)),j(b,c,g,function(e,h){if(e)return f(e);var i=new Nb(c,h.id,g,h.size),j=a.allocDescriptor(i);l(b,i,d,0,d.length,i.position,function(b){return a.releaseDescriptor(j),b?f(b):void f(null)})})}}function W(a,b,c,d){function e(a){d(a?!1:!0)}N(a,b,c,e)}function X(a,b,c,d,e){H(c,e)&&B(b,c,d,e)}function Y(a,b,c,d,e){var f=a.openFiles[c];f?C(b,f,d,e):e(new Lb.EBADF)}function Z(a,b,c,d,e,f,g){"function"==typeof f&&(g=f,f=null),H(c,g)&&z(b,c,d,e,f,g)}function $(a,b,c,d,e,f,g){"function"==typeof f&&(g=f,f=null);var h=a.openFiles[c];h?lb(h.flags).contains(Bb)?A(b,h,d,e,f,g):g(new Lb.EBADF("descriptor does not permit writing")):g(new Lb.EBADF)}function _(a,b,c,d,e){H(c,e)&&D(b,c,d,e)}function ab(a,b,c,d,e){var f=a.openFiles[c];f?lb(f.flags).contains(Bb)?E(b,f,d,e):e(new Lb.EBADF("descriptor does not permit writing")):e(new Lb.EBADF)}function bb(a,b,c,d,e,f){function g(a,b){a?f(a):b.size+d<0?f(new Lb.EINVAL("resulting file offset would be negative")):(h.position=b.size+d,f(null,h.position))}var h=a.openFiles[c];h||f(new Lb.EBADF),"SET"===e?0>d?f(new Lb.EINVAL("resulting file offset would be negative")):(h.position=d,f(null,h.position)):"CUR"===e?h.position+d<0?f(new Lb.EINVAL("resulting file offset would be negative")):(h.position+=d,f(null,h.position)):"END"===e?o(b,h,g):f(new Lb.EINVAL("whence argument is not a proper value"))}function cb(a,b,c,d){H(c,d)&&s(b,c,d)}function db(a,b,c,d,e,f){if(H(c,f)){var g=Date.now();d=d?d:g,e=e?e:g,x(b,c,d,e,f)}}function eb(a,b,c,d,e,f){var g=Date.now();d=d?d:g,e=e?e:g;var h=a.openFiles[c];h?lb(h.flags).contains(Bb)?y(b,h,d,e,f):f(new Lb.EBADF("descriptor does not permit writing")):f(new Lb.EBADF)}function fb(a,b,d,f,g){function h(a,d){a?g(a):c(b,f,d,{ctime:Date.now()},g)}function j(a){a?g(a):b.getObject(x[B].id,h)}function k(a){a?g(a):(delete v[A],b.putObject(u.data,v,j))}function l(a){a?g(a):(x[B]=v[A],b.putObject(w.data,x,k))}function m(a,c){a?g(a):(x=c,lb(x).has(B)?i(b,f,l):l())}function n(a,c){a?g(a):(w=c,b.getObject(w.data,m))}function o(a,c){a?g(a):(v=c,e(b,z,n))}function p(a,c){a?g(a):(u=c,b.getObject(c.data,o))}function s(a){a?g(a):r(b,d,g)}function t(a,c){a?g(a):"DIRECTORY"===c.mode?e(b,y,p):q(b,d,f,s)}if(H(d,g)&&H(f,g)){var u,v,w,x,y=mb.dirname(d),z=mb.dirname(d),A=mb.basename(d),B=mb.basename(f);e(b,d,t)}}function gb(a,b,c,d,e,f){f=arguments[arguments.length-1],H(c,f)&&H(d,f)&&t(b,c,d,f)}function hb(a,b,c,d){H(c,d)&&u(b,c,d)}function ib(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Qb(c,a.name);d(null,e)}}H(c,d)&&p(b,c,e)}function jb(a,b,c,d,e){e=arguments[arguments.length-1],d=d||0,H(c,e)&&v(b,c,d,e)}function kb(a,b,c,d,e){e=arguments[arguments.length-1],d=d||0;var f=a.openFiles[c];f?lb(f.flags).contains(Bb)?w(b,f,d,e):e(new Lb.EBADF("descriptor does not permit writing")):e(new Lb.EBADF)}var lb=a("../../lib/nodash.js"),mb=a("../path.js"),nb=mb.normalize,ob=mb.dirname,pb=mb.basename,qb=mb.isAbsolute,rb=mb.isNull,sb=a("../constants.js"),tb=sb.MODE_FILE,ub=sb.MODE_DIRECTORY,vb=sb.MODE_SYMBOLIC_LINK,wb=sb.MODE_META,xb=sb.ROOT_DIRECTORY_NAME,yb=sb.SUPER_NODE_ID,zb=sb.SYMLOOP_MAX,Ab=sb.O_READ,Bb=sb.O_WRITE,Cb=sb.O_CREATE,Db=sb.O_EXCLUSIVE,Eb=(sb.O_TRUNCATE,sb.O_APPEND),Fb=sb.O_FLAGS,Gb=sb.XATTR_CREATE,Hb=sb.XATTR_REPLACE,Ib=sb.FS_NOMTIME,Jb=sb.FS_NOCTIME,Kb=a("../encoding.js"),Lb=a("../errors.js"),Mb=a("../directory-entry.js"),Nb=a("../open-file-description.js"),Ob=a("../super-node.js"),Pb=a("../node.js"),Qb=a("../stats.js"),Rb=a("../buffer.js");b.exports={ensureRootDirectory:g,open:I,close:J,mknod:K,mkdir:L,rmdir:M,unlink:Q,stat:N,fstat:O,link:P,read:R,readFile:S,write:T,writeFile:U,appendFile:V,exists:W,getxattr:X,fgetxattr:Y,setxattr:Z,fsetxattr:$,removexattr:_,fremovexattr:ab,lseek:bb,readdir:cb,utimes:db,futimes:eb,rename:fb,symlink:gb,readlink:hb,lstat:ib,truncate:jb,ftruncate:kb}},{"../../lib/nodash.js":31,"../buffer.js":36,"../constants.js":37,"../directory-entry.js":38,"../encoding.js":39,"../errors.js":40,"../node.js":45,"../open-file-description.js":46,"../path.js":47,"../stats.js":55,"../super-node.js":56}],42:[function(a,b){function c(a){return"function"==typeof a?a:function(a){if(a)throw a}}function d(a){a&&console.error("Filer error: ",a)}function e(a,b){function c(){I.forEach(function(a){a.call(this)}.bind(F)),I=null}function e(a){return function(b){function c(b){var d=B();a.getObject(d,function(a,e){return a?void b(a):void(e?c(b):b(null,d))})}return f(A).contains(o)?void b(null,B()):void c(b)}}function i(a){if(a.length){var b=r.getInstance();a.forEach(function(a){b.emit(a.event,a.path)})}}a=a||{},b=b||d;var A=a.flags,B=a.guid?a.guid:u,C=a.provider||new p.Default(a.name||j),D=a.name||C.name,E=f(A).contains(k),F=this;F.readyState=m,F.name=D,F.error=null,F.stdin=v,F.stdout=w,F.stderr=x,this.Shell=q.bind(void 0,this);var G={},H=y;Object.defineProperty(this,"openFiles",{get:function(){return G}}),this.allocDescriptor=function(a){var b=H++;return G[b]=a,b},this.releaseDescriptor=function(a){delete G[a]};var I=[];this.queueOrRun=function(a){var b;return l==F.readyState?a.call(F):n==F.readyState?b=new t.EFILESYSTEMERROR("unknown error"):I.push(a),b},this.watch=function(a,b,c){if(g(a))throw new Error("Path must be a string without null bytes.");"function"==typeof b&&(c=b,b={}),b=b||{},c=c||h;var d=new s;return d.start(a,!1,b.recursive),d.on("change",c),d},C.open(function(a){function d(a){function d(a){var b=C[a]();return b.flags=A,b.changes=[],b.guid=e(b),b.close=function(){var a=b.changes;i(a),a.length=0},b}F.provider={openReadWriteContext:function(){return d("getReadWriteContext")},openReadOnlyContext:function(){return d("getReadOnlyContext")}},F.readyState=a?n:l,c(),b(a,F)}if(a)return d(a);var f=C.getReadWriteContext();f.guid=e(f),E?f.clear(function(a){return a?d(a):void z.ensureRootDirectory(f,d)}):z.ensureRootDirectory(f,d)})}var f=a("../../lib/nodash.js"),g=a("../path.js").isNull,h=a("../shared.js").nop,i=a("../constants.js"),j=i.FILE_SYSTEM_NAME,k=i.FS_FORMAT,l=i.FS_READY,m=i.FS_PENDING,n=i.FS_ERROR,o=i.FS_NODUPEIDCHECK,p=a("../providers/index.js"),q=a("../shell/shell.js"),r=a("../../lib/intercom.js"),s=a("../fs-watcher.js"),t=a("../errors.js"),u=a("../shared.js").guid,v=i.STDIN,w=i.STDOUT,x=i.STDERR,y=i.FIRST_DESCRIPTOR,z=a("./implementation.js");e.providers=p,["open","close","mknod","mkdir","rmdir","stat","fstat","link","unlink","read","readFile","write","writeFile","appendFile","exists","lseek","readdir","rename","readlink","symlink","lstat","truncate","ftruncate","utimes","futimes","setxattr","getxattr","fsetxattr","fgetxattr","removexattr","fremovexattr"].forEach(function(a){e.prototype[a]=function(){var b=this,d=Array.prototype.slice.call(arguments,0),e=d.length-1,f="function"!=typeof d[e],g=c(d[e]),h=b.queueOrRun(function(){function c(){h.close(),g.apply(b,arguments)}var h=b.provider.openReadWriteContext();if(n===b.readyState){var i=new t.EFILESYSTEMERROR("filesystem unavailable, operation canceled");return g.call(b,i)}f?d.push(c):d[e]=c;var j=[b,h].concat(d);z[a].apply(null,j)});h&&g(h)}}),b.exports=e},{"../../lib/intercom.js":30,"../../lib/nodash.js":31,"../constants.js":37,"../errors.js":40,"../fs-watcher.js":43,"../path.js":47,"../providers/index.js":48,"../shared.js":52,"../shell/shell.js":54,"./implementation.js":41}],43:[function(a,b){function c(){function a(a){(c===a||h&&0===a.indexOf(b))&&g.trigger("change","change",a)}d.call(this);var b,c,g=this,h=!1;g.start=function(d,g,i){if(!c){if(e.isNull(d))throw new Error("Path must be a string without null bytes.");c=e.normalize(d),h=i===!0,h&&(b="/"===c?"/":c+"/");var j=f.getInstance();j.on("change",a)}},g.close=function(){var b=f.getInstance();b.off("change",a),g.removeAllListeners("change")}}var d=a("../lib/eventemitter.js"),e=a("./path.js"),f=a("../lib/intercom.js");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"../lib/eventemitter.js":29,"../lib/intercom.js":30,"./path.js":47}],44:[function(a,b){b.exports={FileSystem:a("./filesystem/interface.js"),Buffer:a("./buffer.js"),Path:a("./path.js"),Errors:a("./errors.js"),Shell:a("./shell/shell.js")}},{"./buffer.js":36,"./errors.js":40,"./filesystem/interface.js":42,"./path.js":47,"./shell/shell.js":54}],45:[function(a,b){function c(a){var b=Date.now();this.id=a.id,this.mode=a.mode||e,this.size=a.size||0,this.atime=a.atime||b,this.ctime=a.ctime||b,this.mtime=a.mtime||b,this.flags=a.flags||[],this.xattrs=a.xattrs||{},this.nlinks=a.nlinks||0,this.version=a.version||0,this.blksize=void 0,this.nblocks=1,this.data=a.data}function d(a,b,c){a[b]?c(null):a.guid(function(d,e){a[b]=e,c(d)})}var e=a("./constants.js").MODE_FILE;c.create=function(a,b){d(a,"id",function(e){return e?void b(e):void d(a,"data",function(d){return d?void b(d):void b(null,new c(a))})})},b.exports=c},{"./constants.js":37}],46:[function(a,b){function c(a,b,c,d){this.path=a,this.id=b,this.flags=c,this.position=d}var d=a("./errors.js");c.prototype.getNode=function(a,b){function c(a,c){return a?b(a):c?void b(null,c):b(new d.EBADF("file descriptor refers to unknown node",f))}var e=this.id,f=this.path;a.getObject(e,c)},b.exports=c},{"./errors.js":40}],47:[function(a,b,c){function d(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function e(){for(var a="",b=!1,c=arguments.length-1;c>=-1&&!b;c--){var e=c>=0?arguments[c]:"/";"string"==typeof e&&e&&(a=e+"/"+a,b="/"===e.charAt(0))}return a=d(a.split("/").filter(function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."}function f(a){{var b="/"===a.charAt(0);"/"===a.substr(-1)}return a=d(a.split("/").filter(function(a){return!!a}),!b).join("/"),a||b||(a="."),(b?"/":"")+a}function g(){var a=Array.prototype.slice.call(arguments,0);return f(a.filter(function(a){return a&&"string"==typeof a}).join("/"))}function h(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")}function i(a){var b=q(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."}function j(a,b){var c=q(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),""===c?"/":c}function k(a){return q(a)[3]}function l(a){return"/"===a.charAt(0)?!0:!1}function m(a){return-1!==(""+a).indexOf("\x00")?!0:!1}function n(a){return a.replace(/\/*$/,"/")}function o(a){return a=a.replace(/\/*$/,""),""===a?"/":a}var p=/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/,q=function(a){var b=p.exec(a);return[b[1]||"",b[2]||"",b[3]||"",b[4]||""]};b.exports={normalize:f,resolve:e,join:g,relative:h,sep:"/",delimiter:":",dirname:i,basename:j,extname:k,isAbsolute:l,isNull:m,addTrailing:n,removeTrailing:o}},{}],48:[function(a,b){var c=a("./indexeddb.js"),d=a("./websql.js"),e=a("./memory.js");b.exports={IndexedDB:c,WebSQL:d,Memory:e,Default:c,Fallback:function(){function a(){throw"[Filer Error] Your browser doesn't support IndexedDB or WebSQL."}return c.isSupported()?c:d.isSupported()?d:(a.isSupported=function(){return!1},a)}()}},{"./indexeddb.js":49,"./memory.js":50,"./websql.js":51}],49:[function(a,b){(function(c,d){function e(a,b){var c=a.transaction(j,b);this.objectStore=c.objectStore(j)}function f(a,b,c){try{var d=a.get(b);d.onsuccess=function(a){var b=a.target.result;c(null,b)},d.onerror=function(a){c(a)}}catch(e){c(e)}}function g(a,b,c,d){try{var e=a.put(c,b);e.onsuccess=function(a){var b=a.target.result;d(null,b)},e.onerror=function(a){d(a)}}catch(f){d(f)}}function h(a){this.name=a||i,this.db=null}var i=a("../constants.js").FILE_SYSTEM_NAME,j=a("../constants.js").FILE_STORE_NAME,k=a("../constants.js").IDB_RW,l=(a("../constants.js").IDB_RO,a("../errors.js")),m=a("../buffer.js"),n=c.indexedDB||c.mozIndexedDB||c.webkitIndexedDB||c.msIndexedDB;e.prototype.clear=function(a){try{var b=this.objectStore.clear();b.onsuccess=function(){a()},b.onerror=function(b){a(b)}}catch(c){a(c)}},e.prototype.getObject=function(a,b){f(this.objectStore,a,b)},e.prototype.getBuffer=function(a,b){f(this.objectStore,a,function(a,c){return a?b(a):void b(null,new m(c))})},e.prototype.putObject=function(a,b,c){g(this.objectStore,a,b,c)},e.prototype.putBuffer=function(a,b,c){var e;e=d._useTypedArrays?b.buffer:b.toArrayBuffer(),g(this.objectStore,a,e,c)},e.prototype["delete"]=function(a,b){try{var c=this.objectStore["delete"](a);c.onsuccess=function(a){var c=a.target.result;b(null,c)},c.onerror=function(a){b(a)}}catch(d){b(d)}},h.isSupported=function(){return!!n},h.prototype.open=function(a){var b=this;if(b.db)return a();var c=n.open(b.name);c.onupgradeneeded=function(a){var b=a.target.result;b.objectStoreNames.contains(j)&&b.deleteObjectStore(j),b.createObjectStore(j)},c.onsuccess=function(c){b.db=c.target.result,a()},c.onerror=function(){a(new l.EINVAL("IndexedDB cannot be accessed. If private browsing is enabled, disable it."))}},h.prototype.getReadOnlyContext=function(){return new e(this.db,k)},h.prototype.getReadWriteContext=function(){return new e(this.db,k)},b.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{"../buffer.js":36,"../constants.js":37,"../errors.js":40,buffer:57}],50:[function(a,b){function c(a,b){this.readOnly=b,this.objectStore=a}function d(a){this.name=a||e}var e=a("../constants.js").FILE_SYSTEM_NAME,f=a("../../lib/async.js").setImmediate,g=function(){var a={};return function(b){return a.hasOwnProperty(b)||(a[b]={}),a[b]}}();c.prototype.clear=function(a){if(this.readOnly)return void f(function(){a("[MemoryContext] Error: write operation on read only context")});var b=this.objectStore;Object.keys(b).forEach(function(a){delete b[a]}),f(a)},c.prototype.getObject=c.prototype.getBuffer=function(a,b){var c=this;f(function(){b(null,c.objectStore[a])})},c.prototype.putObject=c.prototype.putBuffer=function(a,b,c){return this.readOnly?void f(function(){c("[MemoryContext] Error: write operation on read only context")}):(this.objectStore[a]=b,void f(c))},c.prototype["delete"]=function(a,b){return this.readOnly?void f(function(){b("[MemoryContext] Error: write operation on read only context")}):(delete this.objectStore[a],void f(b))},d.isSupported=function(){return!0},d.prototype.open=function(a){this.db=g(this.name),f(a)},d.prototype.getReadOnlyContext=function(){return new c(this.db,!0)},d.prototype.getReadWriteContext=function(){return new c(this.db,!1)},b.exports=d},{"../../lib/async.js":28,"../constants.js":37}],51:[function(a,b){(function(c){function d(a,b){var c=this;this.getTransaction=function(d){return c.transaction?void d(c.transaction):void a[b?"readTransaction":"transaction"](function(a){c.transaction=a,d(a)})}}function e(a,b,c){function d(a,b){var d=0===b.rows.length?null:b.rows.item(0).data;c(null,d)}function e(a,b){c(b)}a(function(a){a.executeSql("SELECT data FROM "+i+" WHERE id = ? LIMIT 1;",[b],d,e)})}function f(a,b,c,d){function e(){d(null)}function f(a,b){d(b)}a(function(a){a.executeSql("INSERT OR REPLACE INTO "+i+" (id, data) VALUES (?, ?);",[b,c],e,f)})}function g(a){this.name=a||h,this.db=null}var h=a("../constants.js").FILE_SYSTEM_NAME,i=a("../constants.js").FILE_STORE_NAME,j=a("../constants.js").WSQL_VERSION,k=a("../constants.js").WSQL_SIZE,l=a("../constants.js").WSQL_DESC,m=a("../errors.js"),n=a("../buffer.js"),o=a("base64-arraybuffer");d.prototype.clear=function(a){function b(b,c){a(c)}function c(){a(null)}this.getTransaction(function(a){a.executeSql("DELETE FROM "+i+";",[],c,b)})},d.prototype.getObject=function(a,b){e(this.getTransaction,a,function(a,c){if(a)return b(a);try{c&&(c=JSON.parse(c))}catch(d){return b(d)}b(null,c)})},d.prototype.getBuffer=function(a,b){e(this.getTransaction,a,function(a,c){if(a)return b(a);if(c||""===c){var d=o.decode(c);c=new n(d)}b(null,c)})},d.prototype.putObject=function(a,b,c){var d=JSON.stringify(b);f(this.getTransaction,a,d,c)},d.prototype.putBuffer=function(a,b,c){var d=o.encode(b.buffer);f(this.getTransaction,a,d,c)},d.prototype["delete"]=function(a,b){function c(){b(null)}function d(a,c){b(c)}this.getTransaction(function(b){b.executeSql("DELETE FROM "+i+" WHERE id = ?;",[a],c,d)})},g.isSupported=function(){return!!c.openDatabase},g.prototype.open=function(a){function b(b,c){5===c.code&&a(new m.EINVAL("WebSQL cannot be accessed. If private browsing is enabled, disable it.")),a(c)}function d(){e.db=f,a()}var e=this;if(e.db)return a();var f=c.openDatabase(e.name,j,l,k);return f?void f.transaction(function(a){function c(a){a.executeSql("CREATE INDEX IF NOT EXISTS idx_"+i+"_id on "+i+" (id);",[],d,b)}a.executeSql("CREATE TABLE IF NOT EXISTS "+i+" (id unique, data TEXT);",[],c,b)}):void a("[WebSQL] Unable to open database.")},g.prototype.getReadOnlyContext=function(){return new d(this.db,!0)},g.prototype.getReadWriteContext=function(){return new d(this.db,!1)},b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../buffer.js":36,"../constants.js":37,"../errors.js":40,"base64-arraybuffer":32}],52:[function(a,b){function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}).toUpperCase()}function d(){}function e(a){for(var b=[],c=a.length,d=0;c>d;d++)b[d]=a[d];return b}b.exports={guid:c,u8toArray:e,nop:d}},{}],53:[function(a,b){var c=a("../constants.js").ENVIRONMENT;b.exports=function(a){a=a||{},a.TMP=a.TMP||c.TMP,a.PATH=a.PATH||c.PATH,this.get=function(b){return a[b]},this.set=function(b,c){a[b]=c}}},{"../constants.js":37}],54:[function(a,b){function c(a,b){b=b||{};var c=new f(b.env),g="/";Object.defineProperty(this,"fs",{get:function(){return a},enumerable:!0}),Object.defineProperty(this,"env",{get:function(){return c},enumerable:!0}),this.cd=function(b,c){b=d.resolve(g,b),a.stat(b,function(a,d){return a?void c(new e.ENOTDIR(null,b)):void("DIRECTORY"===d.type?(g=b,c()):c(new e.ENOTDIR(null,b)))})},this.pwd=function(){return g}}var d=a("../path.js"),e=a("../errors.js"),f=a("./environment.js"),g=a("../../lib/async.js"),h=(a("../encoding.js"),a("minimatch"));c.prototype.exec=function(a,b,c){var e=this,f=e.fs;"function"==typeof b&&(c=b,b=[]),b=b||[],c=c||function(){},a=d.resolve(e.pwd(),a),f.readFile(a,"utf8",function(a,d){if(a)return void c(a);try{var e=new Function("fs","args","callback",d);e(f,b,c)}catch(g){c(g)}})},c.prototype.touch=function(a,b,c){function e(a){h.writeFile(a,"",c)}function f(a){var d=Date.now(),e=b.date||d,f=b.date||d;h.utimes(a,e,f,c)}var g=this,h=g.fs;"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a=d.resolve(g.pwd(),a),h.stat(a,function(d){d?b.updateOnly===!0?c():e(a):f(a)})},c.prototype.cat=function(a,b){function c(a,b){var c=d.resolve(f.pwd(),a);h.readFile(c,"utf8",function(a,c){return a?void b(a):(i+=c+"\n",void b())})}var f=this,h=f.fs,i="";return b=b||function(){},a?(a="string"==typeof a?[a]:a,void g.eachSeries(a,c,function(a){a?b(a):b(null,i.replace(/\n$/,""))})):void b(new e.EINVAL("Missing files argument"))},c.prototype.ls=function(a,b,c){function f(a,c){var e=d.resolve(h.pwd(),a),j=[];i.readdir(e,function(a,h){function k(a,c){a=d.join(e,a),i.stat(a,function(g,h){if(g)return void c(g);var i={path:d.basename(a),links:h.nlinks,size:h.size,modified:h.mtime,type:h.type};b.recursive&&"DIRECTORY"===h.type?f(d.join(e,i.path),function(a,b){return a?void c(a):(i.contents=b,j.push(i),void c())}):(j.push(i),c())})}return a?void c(a):void g.eachSeries(h,k,function(a){c(a,j)})})}var h=this,i=h.fs;return"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a?void f(a,c):void c(new e.EINVAL("Missing dir argument"))},c.prototype.rm=function(a,b,c){function f(a,c){a=d.resolve(h.pwd(),a),i.stat(a,function(h,j){return h?void c(h):"FILE"===j.type?void i.unlink(a,c):void i.readdir(a,function(h,j){return h?void c(h):0===j.length?void i.rmdir(a,c):b.recursive?(j=j.map(function(b){return d.join(a,b)}),void g.eachSeries(j,f,function(b){return b?void c(b):void i.rmdir(a,c)})):void c(new e.ENOTEMPTY(null,a))})})}var h=this,i=h.fs;return"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a?void f(a,c):void c(new e.EINVAL("Missing path argument"))},c.prototype.tempDir=function(a){var b=this,c=b.fs,d=b.env.get("TMP");a=a||function(){},c.mkdir(d,function(){a(null,d)})},c.prototype.mkdirp=function(a,b){function c(a,b){g.stat(a,function(f,h){if(h){if(h.isDirectory())return void b();if(h.isFile())return void b(new e.ENOTDIR(null,a))}else{if(f&&"ENOENT"!==f.code)return void b(f);var i=d.dirname(a);"/"===i?g.mkdir(a,function(a){return a&&"EEXIST"!=a.code?void b(a):void b()}):c(i,function(c){return c?b(c):void g.mkdir(a,function(a){return a&&"EEXIST"!=a.code?void b(a):void b()})})}})}var f=this,g=f.fs;return b=b||function(){},a?"/"===a?void b():void c(a,b):void b(new e.EINVAL("Missing path argument"))},c.prototype.find=function(a,b,c){function f(a,b){m(a,function(c){return c?void b(c):(n.push(a),void b())})}function i(a,c){var e=d.removeTrailing(a);return b.regex&&!b.regex.test(e)?void c():b.name&&!h(d.basename(e),b.name)?void c():b.path&&!h(d.dirname(e),b.path)?void c():void f(a,c)}function j(a,b){a=d.resolve(k.pwd(),a),l.readdir(a,function(c,e){return c?void("ENOTDIR"===c.code?i(a,b):b(c)):void i(d.addTrailing(a),function(c){return c?void b(c):(e=e.map(function(b){return d.join(a,b)}),void g.eachSeries(e,j,function(a){b(a,n)}))})})}var k=this,l=k.fs;"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){};var m=b.exec||function(a,b){b()},n=[];return a?void l.stat(a,function(b,d){return b?void c(b):d.isDirectory()?void j(a,c):void c(new e.ENOTDIR(null,a))}):void c(new e.EINVAL("Missing path argument"))},b.exports=c},{"../../lib/async.js":28,"../encoding.js":39,"../errors.js":40,"../path.js":47,"./environment.js":53,minimatch:33}],55:[function(a,b){function c(a,b){this.node=a.id,this.dev=b,this.size=a.size,this.nlinks=a.nlinks,this.atime=a.atime,this.mtime=a.mtime,this.ctime=a.ctime,this.type=a.mode}var d=a("./constants.js");c.prototype.isFile=function(){return this.type===d.MODE_FILE},c.prototype.isDirectory=function(){return this.type===d.MODE_DIRECTORY},c.prototype.isSymbolicLink=function(){return this.type===d.MODE_SYMBOLIC_LINK},c.prototype.isSocket=c.prototype.isFIFO=c.prototype.isCharacterDevice=c.prototype.isBlockDevice=function(){return!1},b.exports=c},{"./constants.js":37}],56:[function(a,b){function c(a){var b=Date.now();this.id=d.SUPER_NODE_ID,this.mode=d.MODE_META,this.atime=a.atime||b,this.ctime=a.ctime||b,this.mtime=a.mtime||b,this.rnode=a.rnode}var d=a("./constants.js");c.create=function(a,b){a.guid(function(d,e){return d?void b(d):(a.rnode=a.rnode||e,void b(null,new c(a)))})},b.exports=c},{"./constants.js":37}],57:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e,f=typeof a;if("number"===f)e=a>0?a>>>0:0;else if("string"===f)e=d.byteLength(a,b);else{if("object"!==f||null===a)throw new TypeError("must start with number, buffer, array or string");"Buffer"===a.type&&K(a.data)&&(a=a.data),e=+a.length>0?Math.floor(+a.length):0}if(e>L)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+L.toString(16)+" bytes");var g;d.TYPED_ARRAY_SUPPORT?g=d._augment(new Uint8Array(e)):(g=this,g.length=e,g._isBuffer=!0);var h;if(d.TYPED_ARRAY_SUPPORT&&"number"==typeof a.byteLength)g._set(a);else if(A(a))if(d.isBuffer(a))for(h=0;e>h;h++)g[h]=a.readUInt8(h);else for(h=0;e>h;h++)g[h]=(a[h]%256+256)%256;else if("string"===f)g.write(a,0,b);else if("number"===f&&!d.TYPED_ARRAY_SUPPORT&&!c)for(h=0;e>h;h++)g[h]=0;return e>0&&e<=d.poolSize&&(g.parent=M),g}function e(a,b,c){if(!(this instanceof e))return new e(a,b,c);var f=new d(a,b,c);return delete f.parent,f}function f(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function g(a,b,c,d){var e=G(C(b,a.length-c),a,c,d);return e}function h(a,b,c,d){var e=G(D(b),a,c,d);return e}function i(a,b,c,d){return h(a,b,c,d)}function j(a,b,c,d){var e=G(F(b),a,c,d);return e}function k(a,b,c,d){var e=G(E(b,a.length-c),a,c,d,2);return e}function l(a,b,c){return I.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function m(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=H(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+H(e)}function n(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(127&a[e]);return d}function o(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function p(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=B(a[f]);return e}function q(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function r(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function s(a,b,c,e,f,g){if(!d.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>f||g>b)throw new RangeError("value is out of bounds");if(c+e>a.length)throw new RangeError("index out of range")}function t(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function u(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function v(a,b,c,d,e,f){if(b>e||f>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(0>c)throw new RangeError("index out of range")}function w(a,b,c,d,e){return e||v(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(a,b,c,d,23,4),c+4}function x(a,b,c,d,e){return e||v(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(a,b,c,d,52,8),c+8}function y(a){if(a=z(a).replace(O,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function z(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function A(a){return K(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function B(a){return 16>a?"0"+a.toString(16):a.toString(16)}function C(a,b){var c,d=a.length,e=null;b=b||1/0;for(var f=[],g=0;d>g;g++){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=e-55296<<10|c-56320|65536,e=null}else e&&((b-=3)>-1&&f.push(239,191,189),e=null);if(128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(2097152>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function D(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function E(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function F(a){return I.toByteArray(y(a))}function G(a,b,c,d,e){e&&(d-=d%e);for(var f=0;d>f&&!(f+c>=b.length||f>=a.length);f++)b[f+c]=a[f];return f}function H(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}var I=a("base64-js"),J=a("ieee754"),K=a("is-array");c.Buffer=d,c.SlowBuffer=e,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var L=1073741823,M={};d.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);return b.foo=function(){return 42},42===b.foo()&&"function"==typeof b.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(c){return!1}}(),d.isBuffer=function(a){return!(null==a||!a._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");for(var c=a.length,e=b.length,f=0,g=Math.min(c,e);g>f&&a[f]===b[f];f++);return f!==g&&(c=a[f],e=b[f]),e>c?-1:c>e?1:0},d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(a,b){if(!K(a))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.byteLength=function(a,b){var c;switch(a+="",b||"utf8"){case"ascii":case"binary":case"raw":c=a.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=2*a.length;break;case"hex":c=a.length>>>1;break;case"utf8":case"utf-8":c=C(a).length;break;case"base64":c=F(a).length;break;default:c=a.length}return c},d.prototype.length=void 0,d.prototype.parent=void 0,d.prototype.toString=function(a,b,c){var d=!1;if(b>>>=0,c=void 0===c||1/0===c?this.length:c>>>0,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return p(this,b,c);case"utf8":case"utf-8":return m(this,b,c);case"ascii":return n(this,b,c);case"binary":return o(this,b,c);case"base64":return l(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}},d.prototype.equals=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return 0===d.compare(this,a)},d.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},d.prototype.compare=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return d.compare(this,a)},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var e=d;d=b,b=c,c=e}if(b=Number(b)||0,0>c||0>b||b>this.length)throw new RangeError("attempt to write outside buffer bounds");var l=this.length-b;c?(c=Number(c),c>l&&(c=l)):c=l,d=String(d||"utf8").toLowerCase();
var m;switch(d){case"hex":m=f(this,a,b,c);break;case"utf8":case"utf-8":m=g(this,a,b,c);break;case"ascii":m=h(this,a,b,c);break;case"binary":m=i(this,a,b,c);break;case"base64":m=j(this,a,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=k(this,a,b,c);break;default:throw new TypeError("Unknown encoding: "+d)}return m},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var e;if(d.TYPED_ARRAY_SUPPORT)e=d._augment(this.subarray(a,b));else{var f=b-a;e=new d(f,void 0,!0);for(var g=0;f>g;g++)e[g]=this[g+a]}return e.length&&(e.parent=this.parent||this),e},d.prototype.readUIntLE=function(a,b,c){a>>>=0,b>>>=0,c||r(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},d.prototype.readUIntBE=function(a,b,c){a>>>=0,b>>>=0,c||r(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},d.prototype.readUInt8=function(a,b){return b||r(a,1,this.length),this[a]},d.prototype.readUInt16LE=function(a,b){return b||r(a,2,this.length),this[a]|this[a+1]<<8},d.prototype.readUInt16BE=function(a,b){return b||r(a,2,this.length),this[a]<<8|this[a+1]},d.prototype.readUInt32LE=function(a,b){return b||r(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},d.prototype.readUInt32BE=function(a,b){return b||r(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},d.prototype.readIntLE=function(a,b,c){a>>>=0,b>>>=0,c||r(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},d.prototype.readIntBE=function(a,b,c){a>>>=0,b>>>=0,c||r(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},d.prototype.readInt8=function(a,b){return b||r(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},d.prototype.readInt16LE=function(a,b){b||r(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt16BE=function(a,b){b||r(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt32LE=function(a,b){return b||r(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},d.prototype.readInt32BE=function(a,b){return b||r(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},d.prototype.readFloatLE=function(a,b){return b||r(a,4,this.length),J.read(this,a,!0,23,4)},d.prototype.readFloatBE=function(a,b){return b||r(a,4,this.length),J.read(this,a,!1,23,4)},d.prototype.readDoubleLE=function(a,b){return b||r(a,8,this.length),J.read(this,a,!0,52,8)},d.prototype.readDoubleBE=function(a,b){return b||r(a,8,this.length),J.read(this,a,!1,52,8)},d.prototype.writeUIntLE=function(a,b,c,d){a=+a,b>>>=0,c>>>=0,d||s(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e>>>0&255;return b+c},d.prototype.writeUIntBE=function(a,b,c,d){a=+a,b>>>=0,c>>>=0,d||s(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f>>>0&255;return b+c},d.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,1,255,0),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=a,b+1},d.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):t(this,a,b,!0),b+2},d.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):t(this,a,b,!1),b+2},d.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=a):u(this,a,b,!0),b+4},d.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):u(this,a,b,!1),b+4},d.prototype.writeIntLE=function(a,b,c,d){a=+a,b>>>=0,d||s(this,a,b,c,Math.pow(2,8*c-1)-1,-Math.pow(2,8*c-1));var e=0,f=1,g=0>a?1:0;for(this[b]=255&a;++e<c&&(f*=256);)this[b+e]=(a/f>>0)-g&255;return b+c},d.prototype.writeIntBE=function(a,b,c,d){a=+a,b>>>=0,d||s(this,a,b,c,Math.pow(2,8*c-1)-1,-Math.pow(2,8*c-1));var e=c-1,f=1,g=0>a?1:0;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=(a/f>>0)-g&255;return b+c},d.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,1,127,-128),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=a,b+1},d.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):t(this,a,b,!0),b+2},d.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):t(this,a,b,!1),b+2},d.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):u(this,a,b,!0),b+4},d.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||s(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):u(this,a,b,!1),b+4},d.prototype.writeFloatLE=function(a,b,c){return w(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){return w(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){return x(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){return x(this,a,b,!1,c)},d.prototype.copy=function(a,b,c,e){var f=this;if(c||(c=0),e||0===e||(e=this.length),b>=a.length&&(b=a.length),b||(b=0),e>0&&c>e&&(e=c),e===c)return 0;if(0===a.length||0===f.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=f.length)throw new RangeError("sourceStart out of bounds");if(0>e)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length),a.length-b<e-c&&(e=a.length-b+c);var g=e-c;if(1e3>g||!d.TYPED_ARRAY_SUPPORT)for(var h=0;g>h;h++)a[h+b]=this[h+c];else a._set(this.subarray(c,c+g),b);return g},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");if(0>c||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=C(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},d.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(d.TYPED_ARRAY_SUPPORT)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var N=d.prototype;d._augment=function(a){return a.constructor=d,a._isBuffer=!0,a._get=a.get,a._set=a.set,a.get=N.get,a.set=N.set,a.write=N.write,a.toString=N.toString,a.toLocaleString=N.toString,a.toJSON=N.toJSON,a.equals=N.equals,a.compare=N.compare,a.copy=N.copy,a.slice=N.slice,a.readUIntLE=N.readUIntLE,a.readUIntBE=N.readUIntBE,a.readUInt8=N.readUInt8,a.readUInt16LE=N.readUInt16LE,a.readUInt16BE=N.readUInt16BE,a.readUInt32LE=N.readUInt32LE,a.readUInt32BE=N.readUInt32BE,a.readIntLE=N.readIntLE,a.readIntBE=N.readIntBE,a.readInt8=N.readInt8,a.readInt16LE=N.readInt16LE,a.readInt16BE=N.readInt16BE,a.readInt32LE=N.readInt32LE,a.readInt32BE=N.readInt32BE,a.readFloatLE=N.readFloatLE,a.readFloatBE=N.readFloatBE,a.readDoubleLE=N.readDoubleLE,a.readDoubleBE=N.readDoubleBE,a.writeUInt8=N.writeUInt8,a.writeUIntLE=N.writeUIntLE,a.writeUIntBE=N.writeUIntBE,a.writeUInt16LE=N.writeUInt16LE,a.writeUInt16BE=N.writeUInt16BE,a.writeUInt32LE=N.writeUInt32LE,a.writeUInt32BE=N.writeUInt32BE,a.writeIntLE=N.writeIntLE,a.writeIntBE=N.writeIntBE,a.writeInt8=N.writeInt8,a.writeInt16LE=N.writeInt16LE,a.writeInt16BE=N.writeInt16BE,a.writeInt32LE=N.writeInt32LE,a.writeInt32BE=N.writeInt32BE,a.writeFloatLE=N.writeFloatLE,a.writeFloatBE=N.writeFloatBE,a.writeDoubleLE=N.writeDoubleLE,a.writeDoubleBE=N.writeDoubleBE,a.fill=N.fill,a.inspect=N.inspect,a.toArrayBuffer=N.toArrayBuffer,a};var O=/[^+\/0-9A-z\-]/g},{"base64-js":58,ieee754:59,"is-array":60}],58:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g||b===l?62:b===h||b===m?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0),l="-".charCodeAt(0),m="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],59:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],60:[function(a,b){var c=Array.isArray,d=Object.prototype.toString;b.exports=c||function(a){return!!a&&"[object Array]"==d.call(a)}},{}],61:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:62}],62:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}]},{},[3])(3)});